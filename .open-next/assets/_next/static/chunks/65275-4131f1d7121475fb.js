try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="853c34ae-0203-448e-9c06-53c84a86b5a2",e._sentryDebugIdIdentifier="sentry-dbid-853c34ae-0203-448e-9c06-53c84a86b5a2")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65275],{1667:(e,t,r)=>{r.d(t,{G:()=>x,KK:()=>y,X7:()=>w,Z5:()=>f,Zr:()=>v,_9:()=>m,hk:()=>k,nU:()=>h,us:()=>g});var s=r(84532),i=r(84808),n=r(43839),a=r(83137),o=r(80364),l=r(54265),u=r(20025),d=r(76648),c=r(57178),p=r(25303);function m(e){let t=(0,a.useQueryClient)(),[r,s]=(0,d.useState)(1),n=(0,o.useQuery)({queryKey:["comments",e,{page:r,pageSize:10}],queryFn:async()=>(0,c.zO)("comments-".concat(e,"-").concat(r,"-").concat(10),async()=>{let{data:t}=await i.P.get("/api/comments?postId=".concat(e,"&page=").concat(r,"&pageSize=").concat(10));return null==t||t.forEach(e=>{(0,c.jk)("comments",e),e.user&&(0,c.jk)("users",e.user)}),t||[]}),staleTime:18e4,placeholderData:e=>e}),l=(0,d.useCallback)(()=>{n.isLoading||n.isFetching||s(e=>e+1)},[n.isLoading,n.isFetching]),u=(0,d.useCallback)(()=>{n.isLoading||n.isFetching||t.prefetchQuery({queryKey:["comments",e,{page:r+1,pageSize:10}],queryFn:async()=>{let{data:t}=await i.P.get("/api/comments?postId=".concat(e,"&page=").concat(r+1,"&pageSize=").concat(10));return t||[]}})},[t,e,r,10,n.isLoading,n.isFetching]);return(0,d.useEffect)(()=>{Array.isArray(n.data)&&10===n.data.length&&u()},[n.data,u,10]),{...n,loadMoreComments:l,prefetchNextPage:u,page:r,hasMore:Array.isArray(n.data)&&10===n.data.length}}function y(e){return(0,o.useQuery)({queryKey:["replies",e],queryFn:async()=>(0,c.zO)("replies-".concat(e),async()=>{let{data:t}=await i.P.get("/api/comments/replies?parentId=".concat(e));return null==t||t.forEach(e=>{(0,c.jk)("comments",e),e.user&&(0,c.jk)("users",e.user)}),t||[]}),staleTime:18e4})}function f(){let e=(0,a.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>{let{data:t}=await u.A.post("/api/comments",e);return t&&(0,n.z)({userId:e.author,postId:parseInt(e.post_id),type:"comment",senderId:e.senderId}),t},onMutate:async t=>{let r=t.post_id,s=t.parent_id;s?await e.cancelQueries({queryKey:["replies",s]}):await e.cancelQueries({queryKey:["comments",r]});let i=s?e.getQueryData(["replies",s]):e.getQueryData(["comments",r]),n={id:"temp-".concat(Date.now()),content:t.content,created_at:new Date().toISOString(),author:t.author,post_id:r,parent_id:s||null,likes:0};return s?e.setQueryData(["replies",s],e=>e?[n,...e]:[n]):e.setQueryData(["comments",r],e=>e?[n,...e]:[n]),{previousData:i,postId:r,parentId:s}},onError:(t,r,s)=>{(null==s?void 0:s.parentId)?e.setQueryData(["replies",s.parentId],s.previousData):(null==s?void 0:s.postId)&&e.setQueryData(["comments",s.postId],s.previousData)},onSuccess:(t,r)=>{let s=r.post_id,i=r.parent_id;(0,c.jk)("comments",t),e.setQueryData(["post",parseInt(s)],e=>e?{...e,comment_count:(e.comment_count||0)+1}:e),i?e.invalidateQueries({queryKey:["replies",i]}):e.invalidateQueries({queryKey:["comments",s]})}})}function h(e){let t=(0,a.useQueryClient)();d.useEffect(()=>{let r=s.N.channel("comments-".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"comments"},()=>{t.invalidateQueries({queryKey:["comments",e]})}).on("postgres_changes",{event:"*",schema:"public",table:"comment_likes"},()=>{t.invalidateQueries({queryKey:["comments",e]})}).subscribe();return()=>{s.N.removeChannel(r)}},[e,t])}function v(e){let t=(0,a.useQueryClient)();d.useEffect(()=>{let r=s.N.channel("replies-".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"comments"},()=>{t.invalidateQueries({queryKey:["replies",e]})}).on("postgres_changes",{event:"*",schema:"public",table:"comment_likes"},()=>{t.invalidateQueries({queryKey:["replies",e]})}).subscribe();return()=>{s.N.removeChannel(r)}},[e,t])}function g(e){let t=(0,a.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>{await u.A.post("/api/comments/like",{comment_id:e})},onMutate:async r=>{await t.cancelQueries({queryKey:["comments",e]});let s=t.getQueryData(["comments",e]);return t.setQueryData(["comments",e],e=>e?e.map(e=>e.id===r?{...e,like_count:e.like_count+1,user_liked:!0}:e):[]),{previousComments:s}},onError:(r,s,i)=>{(0,p.vV)("Error liking comment",r),(null==i?void 0:i.previousComments)&&t.setQueryData(["comments",e],i.previousComments)},onSettled:()=>{t.invalidateQueries({queryKey:["comments",e]})}})}function k(e){let t=(0,a.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>{await u.A.delete("/api/comments/like",{data:{comment_id:e}})},onMutate:async r=>{await t.cancelQueries({queryKey:["comments",e]});let s=t.getQueryData(["comments",e]);return t.setQueryData(["comments",e],e=>e?e.map(e=>e.id===r?{...e,like_count:Math.max(e.like_count-1,0),user_liked:!1}:e):[]),{previousComments:s}},onError:(r,s,i)=>{(0,p.vV)("Error unliking comment",r),(null==i?void 0:i.previousComments)&&t.setQueryData(["comments",e],i.previousComments)},onSettled:()=>{t.invalidateQueries({queryKey:["comments",e]})}})}function w(e,t){let r=(0,a.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>{await u.A.post("/api/comments/like",{comment_id:e})},onMutate:async e=>{await r.cancelQueries({queryKey:["replies",t]});let s=r.getQueryData(["replies",t]);return r.setQueryData(["replies",t],t=>t?t.map(t=>t.id===e?{...t,like_count:t.like_count+1,user_liked:!0}:t):[]),{previousComments:s}},onError:(e,s,i)=>{(0,p.vV)("Error liking reply",e),(null==i?void 0:i.previousComments)&&r.setQueryData(["replies",t],i.previousComments)},onSettled:()=>{r.invalidateQueries({queryKey:["replies",t]})}})}function x(e,t){let r=(0,a.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>{await u.A.delete("/api/comments/like",{data:{comment_id:e}})},onMutate:async e=>{await r.cancelQueries({queryKey:["replies",t]});let s=r.getQueryData(["replies",t]);return r.setQueryData(["replies",t],t=>t?t.map(t=>t.id===e?{...t,like_count:Math.max(t.like_count-1,0),user_liked:!1}:t):[]),{previousComments:s}},onError:(e,s,i)=>{(0,p.vV)("Error unliking reply",e),(null==i?void 0:i.previousComments)&&r.setQueryData(["replies",t],i.previousComments)},onSettled:()=>{r.invalidateQueries({queryKey:["replies",t]})}})}},3593:(e,t,r)=>{r.d(t,{A:()=>f});var s=r(71844),i=r(76648),n=r(46032),a=r(83672),o=r(69626),l=r(88348),u=r(40178),d=r(62953),c=r.n(d),p=r(77633),m=r(72925),y=r(86976);function f(e){let{children:t,image:r,postId:d}=e,{userId:f}=(0,a.J)(),[v,g]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),x=(0,o.useRouter)(),{isPinned:_,setPinned:b}=(0,l.s9)(Number(d),f),{data:I}=(0,p.YK)(Number(d)),Q=(0,l.r9)(f),D=(0,l.yu)(f),q=()=>{g(!1)};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{className:"",onClick:()=>g(!0),children:t}),v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:()=>g(!1),className:"fixed z-50  top-0 left-0 h-screen w-full"}),(0,s.jsxs)("div",{className:"absolute w-[180px] xl:w-[240px] z-50 top-2 md:top-6 right-1 xl:right-0 border-primary-8 border-[1px] bg-[#191919] bg-primary-12 rounded-lg",children:[(0,s.jsx)(h,{onClick:()=>{f&&d&&(b(!_),_?D.mutate(Number(d),{onError:e=>{b(!0),y.oR.error("Failed to unpin post: ".concat(e.message))}}):Q.mutate(Number(d),{onError:e=>{b(!1),y.oR.error("Failed to pin post: ".concat(e.message))}}))},icon:_?(0,s.jsx)(n.aS,{width:16,height:16,color:"#F0F0F0"}):(0,s.jsx)(n.ts,{width:16,height:16,color:"#8F8F8F"}),text:_?"Unpin":"Pin",underlineOff:!0}),(0,s.jsx)(h,{onClick:()=>{if(console.log(r),!r.src){q();return}(0,u.GV)(r.src),q()},icon:(0,s.jsx)(n.s3,{width:16,height:16,color:"#8F8F8F"}),text:"Download JPEG",underlineOff:!0}),I&&f&&(0,s.jsx)(h,{onClick:()=>{w(!0),q()},icon:(0,s.jsx)(n.li,{width:16,height:16,color:"#8F8F8F"}),text:"Share"}),(0,s.jsx)(c(),{href:"/home/profile/"+r.author,children:(0,s.jsx)(h,{onClick:()=>{x.push("/home/profile/"+r.author),q()},icon:(0,s.jsx)(n.ny,{width:16,height:16,color:"#8F8F8F"}),text:"Go to creator profile",underlineOff:!0})})]})]}),I&&f&&k&&(0,s.jsxs)("div",{className:"fixed z-50 top-0 left-0 h-screen w-full",children:[" ",(0,s.jsx)(m.A,{open:k,post:I,userId:f,setOpen:w,link:"https://unreal.art/home/photo/"+d})]})]})}function h(e){let{icon:t,text:r,underlineOff:i,action:n,color:a,onClick:o}=e;return(0,s.jsxs)("div",{style:{color:a},onClick:o,className:"flex justify-between py-2 px-4 border-primary-8 text-primary-6 h-10 cursor-pointer ".concat(i?"":"border-b-[1px]"),children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center justify-center text-sm md:text-base",children:[(0,s.jsx)("div",{children:t}),(0,s.jsx)("p",{children:r})]}),n]})}},5430:(e,t,r)=>{r.d(t,{G:()=>u});var s=r(25303);let i=async(e,t)=>{let{data:r,error:i}=await t.from("likes").select("*").eq("post_id",e);return i?((0,s.vV)("Error fetching post likes",i),null):r};var n=r(83137),a=r(80364),o=r(57178),l=r(76648);let u=(e,t)=>{let r=(0,n.useQueryClient)(),s=(0,a.useQuery)({queryKey:["postLikes",e],queryFn:async()=>e?(await (0,o.zO)("postLikes-".concat(e),async()=>{let r=await i(e,t);if(!r)throw Error("Failed to fetch likes");return r})).map(t=>({id:t.id,post_id:e,author:t.author,created_at:t.created_at})):[],staleTime:12e4,gcTime:6e5,enabled:!!e}),u=(0,l.useCallback)(t=>{if(!e||!t||(r.getQueryData(["postLikes",e])||[]).some(e=>e.author===t))return;let s={id:"temp-".concat(Date.now()),post_id:e,author:t,created_at:new Date().toISOString()};r.setQueryData(["postLikes",e],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...e,s]}),r.setQueryData(["post",e],e=>e?{...e,like_count:(e.like_count||0)+1,is_liked_by_user:!0}:e)},[e,r]),d=(0,l.useCallback)(t=>{e&&t&&(r.setQueryData(["postLikes",e],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.author!==t)}),r.setQueryData(["post",e],e=>e?{...e,like_count:Math.max(0,(e.like_count||0)-1),is_liked_by_user:!1}:e))},[e,r]),c=(0,l.useCallback)(e=>(s.data||[]).some(t=>t.author===e),[s.data]),p=(0,l.useCallback)(()=>{e&&r.invalidateQueries({queryKey:["postLikes",e],exact:!0})},[e,r]);return{...s,likes:s.data||[],likesCount:(s.data||[]).length,addLike:u,removeLike:d,hasUserLiked:c,refreshLikes:p}}},14669:(e,t,r)=>{r.d(t,{bh:()=>n,ew:()=>i,ux:()=>s});let s=768,i=["PUBLIC","PRIVATE","LIKED","PINNED","DRAFT"],n=20},15365:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(71844),i=r(46032);function n(e){let{open:t,title:r,titleColor:n,children:a,setOpen:o}=e,l=()=>{o(!1)};if(t)return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{onClick:l,className:"fixed z-30 top-0 left-0 h-screen w-full shadow-bg"}),(0,s.jsxs)("div",{className:"fixed flex justify-center items-center z-30 top-0 left-0 h-screen w-full",children:[(0,s.jsx)("div",{onClick:l,className:"absolute z-30 top-0 left-0 h-screen w-full shadow-bg"}),(0,s.jsxs)("div",{className:"absolute z-50 rounded-[20px] border-primary-8 border-[1px] p-2 py-3 md:p-6 bg-primary-12 w-[98%] max-w-[520px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-6",children:[(0,s.jsx)("p",{style:{color:n},className:"text-2xl text-primary-3 nasalization",children:r}),(0,s.jsx)("button",{onClick:l,children:(0,s.jsx)(i.US,{width:24,height:24,color:"#F5F5F5"})})]}),(0,s.jsx)("div",{children:a})]})]})]})}},17792:(e,t,r)=>{r.d(t,{E3:()=>o,Oj:()=>u,Pk:()=>c,bC:()=>d,i4:()=>p,qY:()=>a,rE:()=>l});var s=r(40178),i=r(14669),n=r(25303);async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=(0,s.eO)(t,i.bh);if(!r){var o;let{error:t,data:s}=await e.auth.getUser();if(t)throw(0,n.vV)("Error fetching user for posts",t),Error("Failed to retrieve authenticated user.");if(!(r=null==s?void 0:null===(o=s.user)||void 0===o?void 0:o.id))throw Error("User ID is undefined.")}let{data:l,error:u}=await e.from("posts").select("*").eq("author",r).neq("isPrivate",!0).neq("isDraft",!0).order("createdAt",{ascending:!1}).range(a[0],a[1]);if(u)throw(0,n.vV)("Supabase error fetching user posts",u),Error(u.message);return l.map(e=>({...e,ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}))}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=(0,s.eO)(t,i.bh);if(!a){var l;let{error:t,data:r}=await e.auth.getUser();if(t)throw(0,n.vV)("Error fetching user for other posts",t),Error("Failed to retrieve authenticated user.");if(!(a=null==r?void 0:null===(l=r.user)||void 0===l?void 0:l.id))throw Error("User ID is undefined.")}let{data:u,error:d}=await e.from("posts").select("*").eq("author",a).neq("id",r).neq("isPrivate",!0).neq("isDraft",!0).order("createdAt",{ascending:!1}).range(o[0],o[1]);if(d)throw(0,n.vV)("Supabase error fetching other user posts",d),Error(d.message);return u.map(e=>({...e,ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}))}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=(0,s.eO)(t,i.bh);if(!r){var o;let{error:t,data:s}=await e.auth.getUser();if(t)throw(0,n.vV)("Error fetching user for private posts",t),Error("Failed to retrieve authenticated user.");if(!(r=null==s?void 0:null===(o=s.user)||void 0===o?void 0:o.id))throw Error("User ID is undefined.")}let{data:l,error:u}=await e.from("posts").select("*").eq("author",r).eq("isPrivate",!0).order("createdAt",{ascending:!1}).range(a[0],a[1]);if(u)throw(0,n.vV)("Supabase error fetching private posts",u),Error(u.message);return l.map(e=>({...e,ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}))}async function u(e){var t,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,l=(0,s.eO)(a,i.bh);if(!o){let{error:r,data:s}=await e.auth.getUser();if(r)throw(0,n.vV)("Error fetching user for pinned posts",r),Error("Failed to retrieve authenticated user.");if(!(o=null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.id))throw Error("User ID is undefined.")}let{data:u,error:d}=await e.from("post_pins").select("\n    posts:posts (\n      *,\n      createdAt\n    )\n  ").eq("user_id",o).filter("posts.isPrivate","neq",!0).filter("posts.isDraft","neq",!0).order("createdAt",{ascending:!1}).range(l[0],l[1]);if(d)throw(0,n.vV)("Supabase error fetching pinned posts",d),Error(d.message);if(!Array.isArray(u))throw(0,n.vV)("Unexpected response from Supabase",{data:u}),Error("Invalid data format received from Supabase.");return null!==(r=null==u?void 0:u.map(e=>{var t,r;let{posts:s}=e;return{...s,author:null!==(t=null==s?void 0:s.author)&&void 0!==t?t:"",category:null!==(r=null==s?void 0:s.category)&&void 0!==r?r:null,ipfsImages:Array.isArray(null==s?void 0:s.ipfsImages)?s.ipfsImages:"string"==typeof(null==s?void 0:s.ipfsImages)?JSON.parse(s.ipfsImages):null}}))&&void 0!==r?r:[]}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=(0,s.eO)(t,i.bh);if(!r){var o;let{error:t,data:s}=await e.auth.getUser();if(t)throw(0,n.vV)("Error fetching user for draft posts",t),Error("Failed to retrieve authenticated user.");if(!(r=null==s?void 0:null===(o=s.user)||void 0===o?void 0:o.id))throw Error("User ID is undefined.")}let{data:l,error:u}=await e.from("posts").select("*").eq("author",r).eq("isDraft",!0).order("createdAt",{ascending:!1}).range(a[0],a[1]);if(u)throw(0,n.vV)("Supabase error fetching draft posts",u),Error(u.message);return l.map(e=>({...e,ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}))}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=(0,s.eO)(t,i.bh);if(!a){var l;let{error:t,data:r}=await e.auth.getUser();if(t)throw(0,n.vV)("Error fetching user for other draft posts",t),Error("Failed to retrieve authenticated user.");if(!(a=null==r?void 0:null===(l=r.user)||void 0===l?void 0:l.id))throw Error("User ID is undefined.")}let{data:u,error:d}=await e.from("posts").select("*").eq("author",a).neq("id",r).eq("isDraft",!0).order("createdAt",{ascending:!1}).range(o[0],o[1]);if(d)throw(0,n.vV)("Supabase error fetching other draft posts",d),Error(d.message);return u.map(e=>({...e,ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}))}async function p(e){var t,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,l=(0,s.eO)(a,i.bh);if(!o){let{error:r,data:s}=await e.auth.getUser();if(r)throw(0,n.vV)("Error fetching user for liked posts",r),Error("Failed to retrieve authenticated user.");if(!(o=null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.id))throw Error("User ID is undefined.")}let{data:u,error:d}=await e.from("likes").select("posts(*),created_at").eq("author",o).neq("posts.isPrivate",!0).neq("posts.isDraft",!0).order("created_at",{ascending:!1}).range(l[0],l[1]);if(d)throw(0,n.vV)("Supabase error fetching liked posts",d),Error(d.message);return(null!==(r=null==u?void 0:u.flatMap(e=>e.posts?[e.posts]:[]))&&void 0!==r?r:[]).map(e=>{var t;return{...e,author:null!==(t=e.author)&&void 0!==t?t:"",ipfsImages:Array.isArray(e.ipfsImages)?e.ipfsImages:"string"==typeof e.ipfsImages?JSON.parse(e.ipfsImages):null}})}},43839:(e,t,r)=>{r.d(t,{z:()=>n});var s=r(84532),i=r(25303);let n=async e=>{let{userId:t,postId:r,type:n,senderId:a}=e;if(t===a)return;let{data:o,error:l}=await s.N.from("notifications").insert([{user_id:t,post_id:r,type:n,sender_id:a}]);return l&&(0,i.vV)("Error adding notification",l),o}},57760:(e,t,r)=>{r.d(t,{$:()=>c});var s=r(84532),i=r(43839),n=r(25303);async function a(e,t,r){try{let{data:a,error:o}=await s.N.from("likes").select("*").eq("author",t).eq("post_id",e).single();if(o&&"PGRST116"!==o.code)return(0,n.vV)("Error fetching like",o),!1;if(a){let{error:e}=await s.N.from("likes").delete().eq("id",a.id);if(e)return(0,n.vV)("Error deleting like",e),!1}else{let{error:a}=await s.N.from("likes").insert([{author:t,post_id:e,post_author:r}]);if(a)return(0,n.vV)("Error adding like",a),!1;await (0,i.z)({userId:r,senderId:t,postId:e,type:"like"})}return!0}catch(e){return(0,n.vV)("An unexpected error occurred",e),!1}}var o=r(83137),l=r(54265),u=r(57178),d=r(76648);let c=(e,t,r)=>{let i=(0,o.useQueryClient)(),c=(0,d.useCallback)(r=>{(0,u.th)(i,e,{like_count:e=>{let t=(null==e?void 0:e.like_count)||0;return r?t+1:Math.max(0,t-1)},is_liked_by_user:r}),i.setQueryData(["postLikes",e],function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r?s.some(e=>e.author===t)?s:[...s,{id:"temp-".concat(Date.now()),author:t,post_id:e}]:s.filter(e=>e.author!==t)})},[i,e,t]);return(0,l.useMutation)({mutationFn:async()=>{let i=t;if(!i){var n;let{data:e,error:t}=await s.N.auth.getUser();if(t||!(null==e?void 0:null===(n=e.user)||void 0===n?void 0:n.id))throw Error("User ID is required to like a post.");i=e.user.id}return await a(e,i,r)},onMutate:async()=>{await Promise.all([i.cancelQueries({queryKey:["postLikes",e]}),i.cancelQueries({queryKey:["post",e]})]);let r=i.getQueryData(["postLikes",e]),s=i.getQueryData(["post",e]),n=null==r?void 0:r.some(e=>e.author===t);return c(!n),{previousLikes:r,previousPost:s,isLiked:n}},onError:(t,r,s)=>{(0,n.vV)("Error toggling like",t),(null==s?void 0:s.previousLikes)&&i.setQueryData(["postLikes",e],s.previousLikes),(null==s?void 0:s.previousPost)&&i.setQueryData(["post",e],s.previousPost),(null==s?void 0:s.isLiked)!==void 0&&c(s.isLiked)},onSuccess:t=>{i.invalidateQueries({queryKey:["post",e],exact:!0}),i.invalidateQueries({queryKey:["postLikes",e],exact:!0})}})}},72925:(e,t,r)=>{r.d(t,{A:()=>d});var s=r(71844),i=r(58425),n=r(15365),a=r(43839),o=r(19382),l=r(86976),u=r(97163);function d(e){let{link:t,open:r,setOpen:i,post:d,userId:p,isProfile:m}=e,{incrementShareCount:y}=(null==d?void 0:d.id)?(0,u.og)(d.id):{incrementShareCount:()=>{}};return(0,s.jsx)(n.A,{title:"Share",open:r,setOpen:i,children:(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{className:"w-full bg-primary-13 rounded-full text-primary-6 py-2 px-4 outline-none",type:"text",value:t,readOnly:!0}),(0,s.jsxs)("div",{className:"flex justify-evenly items-center  bg-primary-10 h-[104px] rounded-[20] mt-6",children:[(0,s.jsx)("div",{className:"border-r-[1px]",children:(0,s.jsx)(c,{image:"copy.png",text:"Copy link",onClick:()=>{navigator.clipboard.writeText(t).then(()=>{console.log("Link copied to clipboard!"),(0,l.oR)("copied")}).catch(e=>{console.error("Failed to copy: ",e)})}})}),(0,s.jsx)(c,{image:"discord.png",text:"Discord",onClick:()=>{!m&&(null==d?void 0:d.id)&&((0,a.z)({userId:null==d?void 0:d.author,senderId:p,postId:null==d?void 0:d.id,type:"share"}),y());let e="https://discord.com/channels/@me?url=".concat(encodeURIComponent(t));window.open(e,"_blank")}}),(0,s.jsx)(o.r6,{url:t,title:"ok",children:(0,s.jsx)(c,{image:"x.png",text:"Xapp",onClick:()=>{!m&&(null==d?void 0:d.id)&&((0,a.z)({userId:null==d?void 0:d.author,senderId:p,postId:null==d?void 0:d.id,type:"share"}),y())}})}),(0,s.jsx)(o.uI,{url:t,title:"ok",children:(0,s.jsx)(c,{image:"facebook.png",text:"Facebook",onClick:()=>{!m&&(null==d?void 0:d.id)&&((0,a.z)({userId:null==d?void 0:d.author,senderId:p,postId:null==d?void 0:d.id,type:"share"}),y())}})}),(0,s.jsx)(o.wk,{url:t,title:"ok",children:(0,s.jsx)(c,{image:"linkedin.png",text:"LinkedIn",onClick:()=>{!m&&(null==d?void 0:d.id)&&((0,a.z)({userId:null==d?void 0:d.author,senderId:p,postId:null==d?void 0:d.id,type:"share"}),y())}})})]})]})})}function c(e){let{image:t,text:r,onClick:n}=e;return(0,s.jsxs)("span",{onClick:n,className:"flex items-center cursor-pointer justify-between flex-col px-2  h-14 ".concat("x.png"===t?"pt-2":""," "),children:[(0,s.jsx)(i.default,{src:"/icons/"+t,width:"x.png"===t?27:36,height:"x.png"===t?27:36,alt:""}),(0,s.jsx)("p",{className:"text-primary-6 text-sm",children:r})]})}},88348:(e,t,r)=>{r.d(t,{r9:()=>c,s9:()=>d,yu:()=>p});var s=r(84532);r(17792);var i=r(83137),n=r(80364),a=r(54265),o=r(57178),l=r(76648),u=r(25303);function d(e,t){let r=(0,i.useQueryClient)(),a=(0,n.useQuery)({queryKey:["post_pinned",e,t],queryFn:async()=>!!e&&!!t&&(0,o.zO)("post-pinned-".concat(e,"-").concat(t),async()=>{let{data:r,error:i}=await s.N.from("post_pins").select("id").eq("post_id",e).eq("user_id",t).single();return i&&"PGRST116"!==i.code?((0,u.vV)("Error checking post pin",i),!1):!!r}),enabled:!!e&&!!t,staleTime:6e5});(0,l.useEffect)(()=>{if(!e||!t)return;let i=s.N.channel("post-pins-".concat(e,"-").concat(t)).on("postgres_changes",{event:"*",schema:"public",table:"post_pins",filter:"post_id=eq.".concat(e," AND user_id=eq.").concat(t)},s=>{"INSERT"===s.eventType?r.setQueryData(["post_pinned",e,t],!0):"DELETE"===s.eventType&&r.setQueryData(["post_pinned",e,t],!1)}).subscribe();return()=>{s.N.removeChannel(i)}},[e,t,r]);let d=(0,l.useCallback)(s=>{r.setQueryData(["post_pinned",e,t],s)},[e,t,r]);return{...a,isPinned:a.data||!1,setPinned:d}}function c(e){let t=(0,i.useQueryClient)();return(0,a.useMutation)({mutationFn:async t=>{if(!t||!e)throw Error("Post ID and User ID are required");let{data:r}=await s.N.from("post_pins").select("id").eq("post_id",t).eq("user_id",e).single();if(r)return{alreadyPinned:!0};let{data:i,error:n}=await s.N.from("post_pins").insert({post_id:t,user_id:e}).select("id").single();if(n)throw n;return{id:i.id,success:!0}},onMutate:async r=>{await Promise.all([t.cancelQueries({queryKey:["post_pinned",r,e]}),t.cancelQueries({queryKey:["pinned-posts",e]})]);let s=t.getQueryData(["post_pinned",r,e]),i=t.getQueryData(["pinned-posts",e]);t.setQueryData(["post_pinned",r,e],!0),(0,o.th)(t,r,{is_pinned:!0});let n=t.getQueryData(["post",r]);return n&&t.setQueryData(["pinned-posts",e],e=>Array.isArray(e)?[n,...e]:[n]),{previousPinned:s,previousPosts:i}},onError:(r,s,i)=>{(null==i?void 0:i.previousPinned)!==void 0&&t.setQueryData(["post_pinned",s,e],i.previousPinned),(null==i?void 0:i.previousPosts)!==void 0&&t.setQueryData(["pinned-posts",e],i.previousPosts),(0,o.th)(t,s,{is_pinned:!1})},onSuccess:()=>{t.invalidateQueries({queryKey:["pinned-posts",e]})}})}function p(e){let t=(0,i.useQueryClient)();return(0,a.useMutation)({mutationFn:async t=>{if(!t||!e)throw Error("Post ID and User ID are required");let{error:r}=await s.N.from("post_pins").delete().eq("post_id",t).eq("user_id",e);if(r)throw r;return{success:!0}},onMutate:async r=>{await Promise.all([t.cancelQueries({queryKey:["post_pinned",r,e]}),t.cancelQueries({queryKey:["pinned-posts",e]})]);let s=t.getQueryData(["post_pinned",r,e]),i=t.getQueryData(["pinned-posts",e]);return t.setQueryData(["post_pinned",r,e],!1),(0,o.th)(t,r,{is_pinned:!1}),t.setQueryData(["pinned-posts",e],e=>Array.isArray(e)?e.filter(e=>e.id!==r):[]),{previousPinned:s,previousPosts:i}},onError:(r,s,i)=>{(null==i?void 0:i.previousPinned)!==void 0&&t.setQueryData(["post_pinned",s,e],i.previousPinned),(null==i?void 0:i.previousPosts)!==void 0&&t.setQueryData(["pinned-posts",e],i.previousPosts),(0,o.th)(t,s,{is_pinned:!0})},onSuccess:()=>{t.invalidateQueries({queryKey:["pinned-posts",e]})}})}}}]);