try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="49c7e34e-b706-4cc8-97d7-eb7c497df1bc",e._sentryDebugIdIdentifier="sentry-dbid-49c7e34e-b706-4cc8-97d7-eb7c497df1bc")}catch(e){}(()=>{var e={};e.id=55680,e.ids=[55680],e.modules={1351:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});let a=(0,r(880).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/a0000/projects/unreal/src/app/home/profile/components/userData.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/a0000/projects/unreal/src/app/home/profile/components/userData.tsx","default")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4668:(e,t,r)=>{Promise.resolve().then(r.bind(r,8133)),Promise.resolve().then(r.bind(r,34944)),Promise.resolve().then(r.bind(r,97131)),Promise.resolve().then(r.bind(r,41002)),Promise.resolve().then(r.bind(r,4628)),Promise.resolve().then(r.bind(r,84198)),Promise.resolve().then(r.bind(r,34265)),Promise.resolve().then(r.bind(r,80944)),Promise.resolve().then(r.bind(r,99484)),Promise.resolve().then(r.bind(r,80412)),Promise.resolve().then(r.bind(r,50116)),Promise.resolve().then(r.bind(r,58764)),Promise.resolve().then(r.bind(r,88268)),Promise.resolve().then(r.bind(r,84508)),Promise.resolve().then(r.bind(r,1351))},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},12412:e=>{"use strict";e.exports=require("assert")},14396:(e,t,r)=>{Promise.resolve().then(r.bind(r,46995)),Promise.resolve().then(r.bind(r,74982)),Promise.resolve().then(r.bind(r,41049)),Promise.resolve().then(r.bind(r,94192)),Promise.resolve().then(r.bind(r,59958)),Promise.resolve().then(r.bind(r,36776)),Promise.resolve().then(r.bind(r,9600)),Promise.resolve().then(r.bind(r,95502)),Promise.resolve().then(r.bind(r,79051)),Promise.resolve().then(r.bind(r,81546)),Promise.resolve().then(r.bind(r,39926)),Promise.resolve().then(r.bind(r,43302)),Promise.resolve().then(r.bind(r,73322)),Promise.resolve().then(r.bind(r,65546)),Promise.resolve().then(r.bind(r,71207))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},20772:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.default,__next_app__:()=>d,pages:()=>u,routeModule:()=>c,tree:()=>o});var a=r(36604),s=r(18659),i=r(51683),l=r(47508),n={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);r.d(t,n);let o={children:["",{children:["home",{children:["profile",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,61863)),"/Users/a0000/projects/unreal/src/app/home/profile/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,61281)),"/Users/a0000/projects/unreal/src/app/home/layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,21887)),"/Users/a0000/projects/unreal/src/app/home/loading.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,42834))).default(e)],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}]},{layout:[()=>Promise.resolve().then(r.bind(r,71569)),"/Users/a0000/projects/unreal/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(r.bind(r,51683)),"/Users/a0000/projects/unreal/src/app/global-error.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,3611)),"/Users/a0000/projects/unreal/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,836,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,33893,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,42834))).default(e)],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}]}.children,u=["/Users/a0000/projects/unreal/src/app/home/profile/[id]/page.tsx"],d={require:r,loadChunk:()=>Promise.resolve()},c=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/home/profile/[id]/page",pathname:"/home/profile/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},37067:e=>{"use strict";e.exports=require("node:http")},38522:e=>{"use strict";e.exports=require("node:zlib")},41204:e=>{"use strict";e.exports=require("string_decoder")},41406:(e,t,r)=>{"use strict";r.d(t,{k:()=>d});var a=r(41049),s=r(81546),i=r(6638),l=r(16709);let n=async(e,t)=>{if(!e)return(0,l.FF)("No userId provided. Returning default stats"),{followeeCount:0,followerCount:0};try{let{count:r,error:a}=await t.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",e);if(a)throw(0,l.vV)("Supabase follower count error",a),Error(`Error fetching follower count: ${a.message}`);let{count:s,error:i}=await t.from("follows").select("*",{count:"exact",head:!0}).eq("followee_id",e);if(i)throw(0,l.vV)("Supabase followee count error",i),Error(`Error fetching followee count: ${i.message}`);return{followerCount:r||0,followeeCount:s||0}}catch(e){throw(0,l.vV)("Server error in getFollowStats",e),e}};var o=r(48506),u=r(89435);function d(e){let t=(0,a.useQueryClient)(),r=(0,s.useQuery)({queryKey:["followStats",e],queryFn:async()=>e?(0,o.zO)(`followStats-${e}`,()=>n(e,i.N)):{followeeCount:0,followerCount:0},enabled:!!e,staleTime:6e5,gcTime:18e5}),l=(0,u.useCallback)(r=>{e&&(t.setQueryData(["followStats",e],e=>e?{...e,followeeCount:e.followeeCount+1}:{followeeCount:1,followerCount:0}),r&&t.setQueryData(["followStats",r],e=>e?{...e,followerCount:e.followerCount+1}:{followeeCount:0,followerCount:1}))},[e,t]),d=(0,u.useCallback)(r=>{e&&(t.setQueryData(["followStats",e],e=>e?{...e,followeeCount:Math.max(0,e.followeeCount-1)}:{followeeCount:0,followerCount:0}),r&&t.setQueryData(["followStats",r],e=>e?{...e,followerCount:Math.max(0,e.followerCount-1)}:{followeeCount:0,followerCount:0}))},[e,t]),c=(0,u.useCallback)(()=>{e&&t.invalidateQueries({queryKey:["followStats",e],exact:!0})},[e,t]);return{...r,incrementFolloweeCount:l,decrementFolloweeCount:d,refreshStats:c,followeeCount:r.data?.followeeCount||0,followerCount:r.data?.followerCount||0}}},41692:e=>{"use strict";e.exports=require("node:tls")},44708:e=>{"use strict";e.exports=require("node:https")},48161:e=>{"use strict";e.exports=require("node:os")},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57012:e=>{"use strict";e.exports=require("tls")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},61863:(e,t,r)=>{"use strict";let a;r.r(t),r.d(t,{default:()=>_,generateImageMetadata:()=>j,generateMetadata:()=>w,generateViewport:()=>C});var s=r(30019),i=r(63033),l=r(81116),n=r(44909),o=r(8133),u=r(18581),d=r(16236),c=r(84508),p=r(70378),m=r(1351),h=r(53767);let f=async(e,t)=>{if(!e)return null;try{let{data:r,error:a}=await t.from("profiles").select("*").eq("id",e).single();if(a)return(0,h.vV)(`Error fetching user profile with ID: ${e}`,a),null;if(!r)return null;return{id:r.id,wallet:r.wallet,bio:r.bio,location:r.location,creditBalance:r.credit_balance,full_name:r.full_name,username:r.display_name||r.full_name,avatar_url:r.avatar_url}}catch(e){return(0,h.vV)("Unexpected error",e),null}};async function x({params:e}){let t=await e;if(!t?.id)return{title:"Unreal Profile",description:"Profile page on Unreal"};try{let e=await (0,d.U)(),r=await f(t.id,e),a=r?.username||r?.full_name||"Unreal Creator",s=r?.avatar_url||"",i=`https://unreal.art/home/profile/${t.id}`;return{title:`${a} | Unreal Profile`,description:`Check out ${a}'s creations on Unreal.`,openGraph:{type:"website",url:i,title:`${a} | Unreal Profile`,description:`Check out ${a}'s creations on Unreal.`,images:s?[{url:s,width:1200,height:630,alt:`${a}'s profile picture`}]:[]},twitter:{card:"summary_large_image",title:`${a} | Unreal Profile`,description:`Check out ${a}'s creations on Unreal.`,images:s?[s]:[]}}}catch(e){return{title:"Unreal Profile",description:"Profile page on Unreal"}}}async function y({searchParams:e,params:t}){let r=await (0,d.U)(),a=new n.E,s=await e,i=await t;return await a.prefetchInfiniteQuery({queryKey:["creation_posts",s?.s||"public"],queryFn:async({pageParam:e=0})=>{let t=await g(r,e,i?.id,s?.s);return{data:t??[],nextCursor:t.length>0?e+1:void 0}},initialPageParam:0,getNextPageParam:e=>e?.nextCursor??void 0,pages:1}),(0,l.jsx)(o.HydrationBoundary,{state:(0,u.hw)(a),children:(0,l.jsxs)("div",{className:"relative flex flex-col items-center background-color-primary-1 px-1 md:px-10 w-full",children:[(0,l.jsx)(m.default,{}),(0,l.jsx)(c.default,{})]})})}async function g(e,t,r,a){switch(a?.toUpperCase()){case"PUBLIC":default:return await (0,p.qY)(e,t,r);case"PRIVATE":return await (0,p.rE)(e,t,r);case"LIKED":return await (0,p.i4)(e,t,r);case"PINNED":return await (0,p.Oj)(e,t,r);case"DRAFT":return await (0,p.bC)(e,t,r)}}let b={...i},v="workUnitAsyncStorage"in b?b.workUnitAsyncStorage:"requestAsyncStorage"in b?b.requestAsyncStorage:void 0;a=new Proxy(y,{apply:(e,t,r)=>{let a,i,l;try{let e=v?.getStore();a=e?.headers.get("sentry-trace")??void 0,i=e?.headers.get("baggage")??void 0,l=e?.headers}catch(e){}return s.wrapServerComponentWithSentry(e,{componentRoute:"/home/profile/[id]",componentType:"Page",sentryTraceHeader:a,baggageHeader:i,headers:l}).apply(t,r)}});let w=x?s.wrapGenerationFunctionWithSentry(x,{componentRoute:"/home/profile/[id]",componentType:"Page",generationFunctionIdentifier:"generateMetadata",requestAsyncStorage:v}):void 0,j=void 0,C=void 0,_=a},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65546:(e,t,r)=>{"use strict";r.d(t,{default:()=>h});var a=r(42434),s=r(89435),i=r(17669),l=r(2492),n=r(7492);r(42988);var o=r(2529),u=r(97828),d=r(59958),c=r(6638),p=r(28350),m=r(82894);function h(){let e=(0,n.useSearchParams)().get("s"),{id:t}=(0,n.useParams)(),{userId:r}=(0,u.J)(),{profileTab:h,initFromUrl:f,setProfileTab:x}=(0,m.g)(),[y,g]=(0,s.useTransition)(),[b,v]=(0,s.useState)(0),w=(0,s.useCallback)(e=>{g(()=>{v(e);let t=o.ew[e]?.toLowerCase();t&&x(t.charAt(0).toUpperCase()+t.slice(1).toLowerCase())})},[x]),j=(0,s.useMemo)(()=>e||h||"Public",[e,h]),{isLoading:C,isError:_,error:P,data:N,hasNextPage:k,fetchNextPage:q,isFetchingNextPage:A}=(0,d.useInfiniteQuery)({queryKey:["profile_posts",j,t],queryFn:async({pageParam:e=0})=>{let r=[],a=j.toUpperCase();return{data:r="PUBLIC"===a?await (0,p.qY)(c.N,e,t):"PRIVATE"===a?await (0,p.rE)(c.N,e,t):"LIKED"===a?await (0,p.i4)(c.N,e,t):"PINNED"===a?await (0,p.Oj)(c.N,e,t):"DRAFT"===a?await (0,p.bC)(c.N,e,t):await (0,p.qY)(c.N,e,t),nextCursor:r.length>0?e+1:void 0}},getNextPageParam:e=>e.nextCursor,initialPageParam:0,staleTime:6e4,gcTime:6e5,refetchOnMount:"always",refetchOnWindowFocus:!1}),D=y||C,E=(0,s.useMemo)(()=>({Public:{title:"Public",content:"You have not published anything yet.",subContent:"Tap your inner artist and create something amazing!"},Private:{title:"Private",content:"You don't have any private post.",subContent:"You can go ahead and create one."},Liked:{title:"Liked",content:"You haven't liked anything yet.",subContent:"Find something you love and tap that \uD83E\uDD0D!"},Pinned:{title:"Pinned",content:"You haven't pinned anything yet.",subContent:"Find something you love and pin it!"},Draft:{title:"Draft",content:"You haven't saved anything yet.",subContent:"Create something you love to post later"}}),[]),S=(0,s.useCallback)(()=>{if(_&&!y)return(0,a.jsx)("div",{className:"text-center text-red-500",children:"message"in P?P.message:"An error occurred"});let e=E[["Public","Private","Liked","Pinned","Draft"][b]];return e?(0,a.jsx)(l.A,{...e,data:N,isLoading:D,hasNextPage:k,fetchNextPage:q,isFetchingNextPage:A}):null},[D,y,_,P,N,b,E,k,q,A]);return(0,a.jsxs)("div",{className:"w-full ",children:[(0,a.jsx)("div",{className:"w-full mb-4",children:(0,a.jsx)(i.A,{currentIndex:b,setCurrentIndex:w,hideDraft:r!==t,section:"profile"})}),(0,a.jsx)("div",{className:"w-full ",children:S()})]})}},71207:(e,t,r)=>{"use strict";r.d(t,{default:()=>O});var a=r(42434),s=r(89435),i=r(41049),l=r(41246),n=r(92049),o=r(41406),u=r(81975),d=r(7492),c=r(6638),p=r(16709);let m=async(e,t)=>{if(!e)return null;try{let{data:r,error:a}=await t.from("profiles").select("*").eq("id",e).single();if(a)return(0,p.vV)(`Error fetching user profile with ID: ${e}`,a),null;if(!r)return null;return{id:r.id,wallet:r.wallet,bio:r.bio,location:r.location,creditBalance:r.credit_balance,full_name:r.full_name,username:r.display_name||r.full_name,avatar_url:r.avatar_url}}catch(e){return(0,p.vV)("Unexpected error",e),null}};var h=r(81546),f=r(48506),x=r(97828);function y(e){let t=(0,i.useQueryClient)(),{userId:r}=(0,x.J)(),a=(0,h.useQuery)({queryKey:["profile_data",e],queryFn:async()=>{if(!e)return null;let t=(0,p.Lk)("getUserData","data-fetching",{profileId:e});try{let r=(0,f.QH)("users",e);if(r)return t(),r;let a=await (0,f.zO)(`user-profile-${e}`,async()=>{let t=(0,p.Lk)("getUserById","database-query",{profileId:e}),r=await m(e,c.N);return t(),r});return a&&(0,f.jk)("users",{...a,id:e}),t(),a}catch(e){throw t(),e}},enabled:!!e,staleTime:3e5,gcTime:18e5,retry:1}),l=(0,s.useCallback)(r=>{if(!e)return;let a=(0,p.Lk)("updateUserDataOptimistically","client-update",{profileId:e,updateFields:Object.keys(r)});(0,p.Rm)("Current data in cache",t.getQueryData(["profile_data",e])),(0,p.Rm)("Applying updates",r);let s=["full_name","display_name","bio"],i={};Object.entries(r).forEach(([e,t])=>{(s.includes(e)||"display_name"===e||"firstname"===e||"lastname"===e)&&(i[e]=t)}),t.setQueryData(["profile_data",e],t=>{if(!t)return t;i.display_name&&(i.username=i.display_name);let r={...t,...i};return(0,p.Rm)("New data after merge",r),(0,f.jk)("users",{...r,id:e}),r}),a()},[e,t]),n=(0,s.useMemo)(()=>!!r&&r===e,[r,e]);return{...a,updateUserDataOptimistically:l,isOwnProfile:n,profileId:e}}var g=r(41207);r(79571);let b=()=>(0,a.jsxs)("div",{className:"flex flex-col md:flex-row pt-5 w-full mb-12 gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-28 h-28 md:w-52 md:h-52",children:(0,a.jsx)(g.A,{circle:!0,height:"100%",baseColor:"#1a1a1a",highlightColor:"#333"})}),(0,a.jsxs)("div",{className:"block md:hidden",children:[(0,a.jsx)(g.A,{width:150,height:32,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsxs)("div",{className:"flex my-4 gap-3",children:[(0,a.jsx)(g.A,{width:112,height:36,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsx)(g.A,{width:48,height:36,baseColor:"#1a1a1a",highlightColor:"#333"})]})]})]}),(0,a.jsxs)("div",{className:"flex-grow text-primary-5",children:[(0,a.jsxs)("div",{className:"hidden md:block",children:[(0,a.jsx)(g.A,{width:200,height:32,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsxs)("div",{className:"flex my-4 gap-3",children:[(0,a.jsx)(g.A,{width:112,height:36,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsx)(g.A,{width:48,height:36,baseColor:"#1a1a1a",highlightColor:"#333"})]})]}),(0,a.jsxs)("div",{className:"flex gap-x-4 my-4",children:[(0,a.jsx)(g.A,{width:80,height:32,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsx)(g.A,{width:80,height:32,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsx)(g.A,{width:80,height:32,baseColor:"#1a1a1a",highlightColor:"#333"})]}),(0,a.jsx)(g.A,{width:50,height:24,baseColor:"#1a1a1a",highlightColor:"#333"}),(0,a.jsx)(g.A,{width:"80%",height:18,count:2,baseColor:"#1a1a1a",highlightColor:"#333"})]}),(0,a.jsx)("div",{className:"hidden md:block",children:(0,a.jsx)(g.A,{width:120,height:40,baseColor:"#1a1a1a",highlightColor:"#333"})})]});var v=r(22229);function w({openProfile:e,deleteProfile:t}){return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("button",{onClick:e,className:"flex h-12 items-center gap-2",children:[(0,a.jsx)(l.kG,{color:"#C1C1C1"}),(0,a.jsx)("p",{className:"text-primary-6",children:"Edit Profile"})]}),(0,a.jsxs)("button",{onClick:t,className:"flex h-11 items-center gap-2",children:[(0,a.jsx)(l.d7,{color:"#FF5252"}),(0,a.jsx)("p",{className:"text-[#FF5252]",children:"Delete Account Permanently"})]})]})}var j=r(5450);let C=()=>{let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)(null),i=(0,d.useRouter)();return{deleteAccount:async()=>{t(!0),a(null),(0,p.Rm)("Account deletion process initiated");try{let{data:e,error:t}=await c.N.auth.getUser();if(t||!e.user){let e="You need to be logged in.";throw(0,p.vV)(e,t||Error(e)),Error(e)}let{data:r}=await c.N.auth.getSession();(0,p.Rm)("Sending account deletion request",{userId:e.user.id});let a=await j.P.delete("/api/account/delete",{headers:{"Content-Type":"application/json"},data:{userId:e.user.id,token:r.session?.access_token}});return 200===a.status&&((0,p.Rm)("Account deleted successfully, logging out user"),await c.N.auth.signOut(),i.push("/")),{success:!0}}catch(t){let e=t.response?.data?.error||t.message||"An unexpected error occurred";return(0,p.vV)("Account deletion failed",t),a(e),{success:!1,error:e}}finally{t(!1)}},loading:e,error:r}};var _=r(16862);function P({closeAction:e}){let{deleteAccount:t,loading:r,error:i}=C(),[l,n]=(0,s.useState)(""),o=async e=>{if(e.preventDefault(),"DELETE"!==l){_.oR.error("Please enter the correct confirmation");return}await t()};return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("p",{className:"text-primary-7 text-sm",children:["Deleting your account will permanently remove your profile, credits, and all associated data, including your generated images and history. Any remaining credits will be lost, and this action is irreversible. To confirm, type ",(0,a.jsx)("strong",{className:"text-primary-5",children:"DELETE"})," in the field below."]}),(0,a.jsxs)("form",{children:[(0,a.jsx)("label",{className:"text-primary-4 mb-2 block",children:"Confirm Account Deletion"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none placeholder:text-primary-7 indent-4",type:"text",placeholder:"Enter DELETE to proceed",onChange:e=>n(e.target.value)}),(0,a.jsxs)("div",{className:"flex justify-end h-12 mb-4 mt-8 text-primary-6 gap-4",children:[(0,a.jsx)("button",{onClick:e,className:"border-primary-10 w-40 border-[1px] rounded-full",children:"Cancel"}),(0,a.jsx)("button",{className:`${"DELETE"!==l?"border-primary-10":"bg-primary-10 "} w-40 rounded-full text-primary-3 disabled:bg-primary-11 disabled:text-primary-9`,disabled:"DELETE"!==l,type:"button",onClick:o,children:"Delete Account"})]})]})]})}var N=r(98678),k=r(9600);let q=()=>{let e=(0,i.useQueryClient)(),t=(0,s.useRef)(null),r=(0,s.useRef)(null),a=(0,k.useMutation)({mutationFn:async({user:e,id:t,preserveFields:r=!1})=>{if(!t)throw Error("User ID is required");let a={},s=["full_name","display_name","bio"];if(Object.entries(e).forEach(([e,t])=>{s.includes(e)&&void 0!==t&&(a[e]=t)}),0===Object.keys(a).length)return(0,p.Rm)("No valid fields to update"),e;(0,p.Rm)("Final updates to send to API:",a);let{data:i,error:l}=await c.N.from("profiles").update(a).eq("id",t).select();if(l)throw Error(l.message);let n={...e,...i?.[0]||{}};return n.credit_balance&&0!==n.credit_balance&&(n.creditBalance=n.credit_balance),n},onMutate:async({user:t,id:r})=>{await Promise.all([e.cancelQueries({queryKey:["user"]}),e.cancelQueries({queryKey:["profile_data",r]}),e.cancelQueries({queryKey:["user",r]})]);let a=e.getQueryData(["user"]),s=e.getQueryData(["profile_data",r]),i=e.getQueryData(["user",r]);if(e.setQueryData(["user"],e=>e&&e.user?{...e,user:{...e.user,...t}}:e),e.setQueryData(["profile_data",r],e=>e?{...e,...t}:e),r){let e=(0,f.QH)("users",r)||{};(0,p.Rm)("Existing entity before update",e),(0,p.Rm)("Updates being applied",t);let a={...t};a.username=t.display_name,(0,p.Rm)("Enhanced client cache update",a),(0,f.jk)("users",{...e,...a,id:r})}return{previousUser:a,previousProfile:s,previousUserData:i,id:r}},onError:(t,{id:r},a)=>{(0,p.vV)("Error updating user details:",t),_.oR.error(`Failed to update profile: ${t.message}`),a?.previousUser&&e.setQueryData(["user"],a.previousUser),a?.previousProfile&&e.setQueryData(["profile_data",r],a.previousProfile),a?.previousUserData&&e.setQueryData(["user",r],a.previousUserData)},onSuccess:(t,{id:r})=>{_.oR.success("Profile updated successfully"),(0,f.jk)("users",{id:r,...t}),t.avatar_url&&(e.invalidateQueries({queryKey:["user"]}),e.invalidateQueries({queryKey:["profile_data",r]}),e.invalidateQueries({queryKey:["user",r]}))}}),l=(0,s.useCallback)((s,i)=>{if((0,p.Rm)("Throttled update called with",{id:s,updates:i}),r.current){(0,p.Rm)("Existing pending updates",r.current);let e=(i.hasOwnProperty("firstname")||i.hasOwnProperty("lastname"))&&!i.hasOwnProperty("display_name")&&r.current.user.display_name;r.current={id:s,user:{...r.current.user,...i}},e&&((0,p.Rm)("Preserving display_name when combining updates with first/last name changes"),r.current.user.display_name=r.current.user.display_name),(0,p.Rm)("Combined pending updates",r.current);return}r.current={user:i,id:s},(0,p.Rm)("Stored pending update",r.current),t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{if(r.current){(0,p.Rm)("Processing throttled update");let i=e.getQueryData(["profile_data",s]);if((0,p.Rm)("Current profile data from cache",i),i){let e={},l=r.current?.user||{},n=["full_name","display_name","bio"];if((l.hasOwnProperty("firstname")||l.hasOwnProperty("lastname"))&&!l.hasOwnProperty("display_name")&&i.display_name&&((0,p.Rm)("Name update detected - explicitly preserving display_name",i.display_name),l.display_name=i.display_name),Object.entries(l).forEach(([t,r])=>{n.includes(t)&&void 0!==r&&(e[t]=r)}),!e.full_name&&(l.hasOwnProperty("firstname")||l.hasOwnProperty("lastname"))){(0,p.Rm)("Handling firstname/lastname update");let t=l.firstname||(i.full_name?i.full_name.split(" ")[0]:""),r=l.lastname||(i.full_name&&i.full_name.split(" ").length>1?i.full_name.split(" ").slice(1).join(" "):"");e.full_name=`${t} ${r}`.trim(),(0,p.Rm)("Setting full_name from first/last name",e.full_name)}if(e.full_name&&!e.display_name&&i.display_name&&((0,p.Rm)("Re-checking display_name is preserved during name update"),e.display_name=i.display_name),0===Object.keys(e).length){(0,p.Rm)("No valid fields to update, skipping"),r.current=null,t.current=null;return}(0,p.Rm)("Final update data to send to API",e),a.mutate({user:e,id:s,preserveFields:!0})}else{(0,p.Rm)("No current data found, using safer update approach");let e={},t=r.current?.user||{},i=["full_name","display_name","bio"];Object.entries(t).forEach(([t,r])=>{i.includes(t)&&void 0!==r&&(e[t]=r)}),Object.keys(e).length>0&&a.mutate({user:e,id:s,preserveFields:!0})}r.current=null,t.current=null}},500)},[a,e]),n=(0,s.useCallback)((e,t,r)=>a.mutate({user:{[t]:r},id:e}),[a]),o=(0,s.useCallback)((t,r)=>{let s=e.getQueryData(["profile_data",t]),i={},l=["full_name","display_name","bio"];return Object.entries(r).forEach(([e,t])=>{l.includes(e)&&void 0!==t&&(i[e]=t)}),i.full_name&&!i.display_name&&s?.display_name&&(i.display_name=s.display_name),a.mutate({user:i,id:t,preserveFields:!0})},[a,e]);return{...a,updateUserField:n,throttledUpdateUser:l,updateViewedProfile:o}};var A=r(64393);function D({profileId:e,closeAction:t}){let{user:r}=(0,x.J)(),{data:i,updateUserDataOptimistically:l}=y(e),{updateViewedProfile:n,throttledUpdateUser:o}=q(),[u,d]=(0,s.useState)((0,N.W0)(i?.full_name||"").firstName),[c,m]=(0,s.useState)((0,N.W0)(i?.full_name||"").lastName),[h,f]=(0,s.useState)(i?.full_name||""),[g,b]=(0,s.useState)(i?.bio||""),[v,w]=(0,s.useState)(i?.display_name||i?.username||""),[j]=(0,s.useState)(r?.email||"");return(0,a.jsx)("div",{className:"flex flex-col gap-3",children:(0,a.jsxs)("form",{onSubmit:r=>{if(r.preventDefault(),!e){_.oR.error("Cannot update profile: User ID is missing");return}if((0,p.Rm)("Profile update initiated",{full_name:h,displayName:v}),!h||!v){_.oR.error("Please fill in all fields.");return}(0,p.Rm)("Current profile data before update",{profileData:i});let a={full_name:h,bio:g,display_name:v};(0,p.Rm)("Sending profile updates",a),l(a),n(e,a),t()},className:"grid grid-cols-2 gap-5 text-primary-8 text-sm",children:[(0,a.jsxs)("div",{className:"col-span-2 py-3 border-b-[1px] border-primary-9",children:[(0,a.jsx)("label",{className:"mb-2 block text-primary-2",children:"Profile photo"}),(0,a.jsx)("div",{children:(0,a.jsx)(A.default,{className:"rounded-full",src:i?.avatar_url||"/profile.jpg",width:80,height:80,alt:""})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-1 block",children:"First Name"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none text-primary-5 placeholder:text-primary-7 indent-4",type:"text",placeholder:"Jon",value:u,onChange:e=>{d(e.target.value)}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-1 block",children:"Last Name"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none text-primary-5 placeholder:text-primary-7 indent-4",type:"text",placeholder:"Doe",value:c,onChange:e=>{m(e.target.value)}})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-primary-4 mb-1 block",children:"Display name"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none text-primary-5 placeholder:text-primary-7 indent-4",type:"text",placeholder:"Jon Doe",value:v,onChange:e=>{w(e.target.value)}})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"mb-1 block",children:"Email Address"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none text-primary-5 placeholder:text-primary-7 indent-4",type:"text",placeholder:"Jondoe@gmail.com",readOnly:!0,value:j})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-primary-4 mb-1 block",children:"Bio"}),(0,a.jsx)("input",{className:"block border-[1px] border-primary-10 h-14 w-full rounded-2xl bg-inherit outline-none text-primary-5 placeholder:text-primary-7 indent-4",type:"text",placeholder:"Enter your bio",value:g,onChange:e=>{b(e.target.value)}})]}),(0,a.jsxs)("div",{className:"rounded-2xl flex items-center justify-end col-span-2 space-x-5",children:[(0,a.jsx)("button",{onClick:t,type:"button",className:"cursor-pointer transition duration-300 hover:scale-105 px-8 py-3 rounded-full border-[1px] border-primary-10 text-primary-4",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"bg-primary-1 text-black font-semibold cursor-pointer transition duration-300 hover:scale-105 px-8 py-3 rounded-full",children:"Save"})]})]})})}var E=r(43165),S=r(59241),R=r(18726),U=r(39648),Q=r(15337),F=r(58312);let I=(0,N.yt)(U.h,"0x37719927bbf857b4e2c0195aee74e7b3f1161a77");function O(){let[e,t]=(0,s.useState)(!1),[r,c]=(0,s.useState)(!1),[p,m]=(0,s.useState)(!1),[h,f]=(0,s.useState)("");(0,i.useQueryClient)();let g=(0,d.useParams)().id,{data:j,isLoading:C,error:_,isOwnProfile:N,updateUserDataOptimistically:k}=y(g),{userId:A,user:U,loading:O}=(0,x.J)(),{updateViewedProfile:T}=q(),{followeeCount:$,followerCount:L}=(0,o.k)(g),{data:V}=(0,u.r)(g),{data:K,refetch:M}=(0,R.Q)({contract:I,method:"function balanceOf(address account) returns (uint256)",params:[U?.wallet?.address||""]});if(C||O||!U)return(0,a.jsx)(b,{});if(_)return(0,a.jsxs)("p",{children:["Error loading profile data: ",_.message]});let B=()=>{N&&(t(!0),f("Edit Account"))},Y=()=>{t(!1),f("")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row pt-5 w-full mb-12 gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-28 h-28 md:w-52 md:h-52",children:(0,a.jsx)(F.A,{className:"rounded-full",src:j?.avatar_url||"/profile.jpg",width:200,height:200,alt:`${j?.full_name}'s profile picture`,trackPerformance:!0,imageName:`profile-${g}`})}),(0,a.jsxs)("div",{className:"block md:hidden",children:[(0,a.jsx)("p",{className:"text-3xl font-medium",children:j?.full_name}),(0,a.jsxs)("div",{className:"flex my-4 gap-3",children:[N&&(0,a.jsx)("button",{onClick:B,className:"flex justify-center items-center h-9 w-28 text-primary-4 font-medium text-sm topup-btn-gradient rounded-2xl bg-primary-11",children:(0,a.jsx)("p",{className:"text-sm",children:"Edit Account"})}),(0,a.jsx)("button",{className:"flex justify-center items-center h-9 w-12 text-primary-4 font-medium text-sm topup-btn-gradient rounded-2xl bg-primary-11",children:(0,a.jsx)(l.uX,{width:16,height:16,color:"#DADADA"})})]})]})]}),(0,a.jsxs)("div",{className:"flex-grow text-primary-5",children:[(0,a.jsxs)("div",{className:"hidden md:block",children:[(0,a.jsx)("p",{className:"text-3xl font-medium",children:j?.full_name}),(0,a.jsxs)("div",{className:"flex my-4 gap-3",children:[N&&(0,a.jsx)("button",{onClick:B,className:"flex justify-center items-center h-9 w-28 text-primary-4 font-medium text-sm topup-btn-gradient rounded-2xl bg-primary-11",children:(0,a.jsx)("p",{className:"text-sm",children:"Edit Account"})}),(0,a.jsx)("button",{onClick:()=>m(!0),className:"flex justify-center items-center h-9 w-12 text-primary-4 font-medium text-sm topup-btn-gradient rounded-2xl bg-primary-11",children:(0,a.jsx)(l.uX,{width:16,height:16,color:"#DADADA"})})]})]}),(0,a.jsxs)("div",{className:"flex gap-x-4 my-4",children:[(0,a.jsx)(n.A,{value:$?.toString()||"0",title:1===$?"Follower":"Followers"}),(0,a.jsx)(n.A,{value:L?.toString()||"0",title:"Following",leftBorder:!0}),(0,a.jsx)(n.A,{value:V?.toString()||"0",title:1===V?"Like":"Likes",leftBorder:!0})]}),(0,a.jsx)("p",{className:"text-primary-7 my-4",children:" Bio "}),(0,a.jsxs)("p",{className:"text-primary-7 my-4",children:[" ",j?.bio," "]})]}),(0,a.jsx)(S.A,{open:r,setOpen:c,refetch:M}),(0,a.jsx)("div",{className:"hidden md:block",children:N&&(0,a.jsxs)("button",{onClick:()=>c(!0),className:"flex gap-2 whitespace-nowrap text-primary-4 font-medium text-sm topup-btn-gradient p-3 rounded-md bg-primary-11",children:[(0,a.jsx)("div",{children:(0,a.jsx)(l.gX,{width:16,height:16,color:"#DADADA"})}),(0,a.jsx)("p",{children:(()=>{let e=(j?.creditBalance??0)+(K?Number((0,Q.ck)(K))/3:0);return`${e.toFixed(2)} Credit${1!==e?"s":""}`})()})]})})]}),(0,a.jsx)(E.A,{open:p,setOpen:m,link:"https://unreal.art/home/profile/"+g,isProfile:!0}),(0,a.jsxs)(v.A,{title:h,open:e,setOpen:t,titleColor:"Delete Account"===h?"#FF5252":void 0,children:["Edit Account"===h&&(0,a.jsx)(w,{openProfile:()=>f("Edit Profile"),deleteProfile:()=>f("Delete Account")}),"Delete Account"===h&&(0,a.jsx)(P,{closeAction:Y}),"Edit Profile"===h&&j&&(0,a.jsx)(D,{profileId:g,closeAction:Y})]})]})}},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74998:e=>{"use strict";e.exports=require("perf_hooks")},75919:e=>{"use strict";e.exports=require("node:worker_threads")},76760:e=>{"use strict";e.exports=require("node:path")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},80481:e=>{"use strict";e.exports=require("node:readline")},81630:e=>{"use strict";e.exports=require("http")},81975:(e,t,r)=>{"use strict";r.d(t,{r:()=>d});var a=r(41049),s=r(81546),i=r(6638),l=r(16709);let n=async(e,t)=>{if(!e)return 0;try{let{count:r,error:a}=await t.from("likes").select("*",{count:"exact"}).eq("post_author",e);if(a)return(0,l.vV)("Error fetching like count",a),0;return r||0}catch(e){return(0,l.vV)("Unexpected error",e),0}};var o=r(48506),u=r(89435);let d=e=>{let t=(0,a.useQueryClient)(),r=(0,s.useQuery)({queryKey:["likeStat",e],queryFn:async()=>e?(0,o.zO)(`likeStat-${e}`,()=>n(e,i.N)):0,enabled:!!e,staleTime:6e5,gcTime:18e5}),l=(0,u.useCallback)(()=>{e&&t.setQueryData(["likeStat",e],e=>(e||0)+1)},[e,t]),d=(0,u.useCallback)(()=>{e&&t.setQueryData(["likeStat",e],e=>Math.max(0,(e||0)-1))},[e,t]),c=(0,u.useCallback)(()=>{e&&t.invalidateQueries({queryKey:["likeStat",e],exact:!0})},[e,t]);return{...r,incrementLikeStat:l,decrementLikeStat:d,refreshLikeStat:c,likeCount:r.data||0}}},83997:e=>{"use strict";e.exports=require("tty")},84297:e=>{"use strict";e.exports=require("async_hooks")},84508:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});let a=(0,r(880).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/a0000/projects/unreal/src/app/home/profile/components/profileView.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/a0000/projects/unreal/src/app/home/profile/components/profileView.tsx","default")},86592:e=>{"use strict";e.exports=require("node:inspector")},91645:e=>{"use strict";e.exports=require("net")},92049:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(42434);function s({value:e,title:t,leftBorder:r}){return(0,a.jsxs)("div",{className:`flex flex-col md:flex-row md:items-center gap-2 border-primary-6 px-5 ${r&&"border-l-[1px]"}`,children:[(0,a.jsx)("p",{className:"text-xl text-primary-5",children:e}),(0,a.jsx)("p",{className:"text-primary-6",children:t})]})}},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[97015,30019,78660,56445,49008,81511,14464,69717,17924,23996,23391,94642,53842,46708,68928],()=>r(20772));module.exports=a})();
//# sourceMappingURL=page.js.map