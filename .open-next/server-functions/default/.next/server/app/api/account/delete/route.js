try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6d17abe7-0aba-4157-8f73-fcc13da30572",e._sentryDebugIdIdentifier="sentry-dbid-6d17abe7-0aba-4157-8f73-fcc13da30572")}catch(e){}(()=>{var e={};e.id=49343,e.ids=[49343],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},37067:e=>{"use strict";e.exports=require("node:http")},38522:e=>{"use strict";e.exports=require("node:zlib")},41692:e=>{"use strict";e.exports=require("node:tls")},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},53767:(e,t,r)=>{"use strict";r.d(t,{FF:()=>p,Lk:()=>l,vV:()=>d});var s=r(30019);let i={},o=e=>{if(null==e)return"";if("string"==typeof e)return e.substring(0,5e3);try{let t=JSON.stringify(e);return t.length>5e3?t.substring(0,5e3)+"...[truncated]":t}catch(e){return"[Object cannot be serialized]"}},n=()=>{let e=Date.now(),t=Object.keys(i);t.length>100&&t.map(e=>i[e]&&"number"==typeof i[e].timestamp?{key:e,time:i[e].timestamp}:{key:e,time:0}).sort((e,t)=>e.time-t.time).slice(0,t.length-50).map(e=>e.key).forEach(e=>delete i[e]),t.forEach(t=>{i[t]&&"number"==typeof i[t].timestamp&&e-i[t].timestamp>5e4?delete i[t]:i[t]&&"number"==typeof i[t].timestamp||delete i[t]})},u=e=>{let t=Date.now();if(i[e]){let{timestamp:r,count:s}=i[e];if(t-r<5e3)return i[e].count++,!0;i[e].timestamp=t,i[e].count++}else i[e]={timestamp:t,count:1},Object.keys(i).length>100&&n();return!1},a=(e,t)=>{let r=e instanceof Error?e.message:String(e);if(u(`error:${r.substring(0,100)}`))return;let i=t?Object.fromEntries(Object.entries(t).map(([e,t])=>[e,o(t)])):void 0;e instanceof Error?s.captureException(e,{extra:i}):s.captureException(Error(String(e)),{extra:i})},c=(e,t="info",r)=>{if("info"===t)return;let i=e.substring(0,200);if(u(`${t}:${i}`))return;let n=r?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,o(t)])):void 0;s.captureMessage(i,{level:t,extra:n})},d=(e,t)=>{let r=t instanceof Error?t.message:String(t);u(`error:${e}:${r.substring(0,50)}`)||(t?a(t,{message:e}):c(e,"error"))},p=(e,t)=>{u(`warning:${e}`)||c(e,"warning")},l=(e,t,r)=>()=>{}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57012:e=>{"use strict";e.exports=require("tls")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69764:()=>{},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74323:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>U,routeModule:()=>_,serverHooks:()=>I,workAsyncStorage:()=>O,workUnitAsyncStorage:()=>k});var s={};r.r(s),r.d(s,{DELETE:()=>b,GET:()=>h,HEAD:()=>v,OPTIONS:()=>E,PATCH:()=>w,POST:()=>g,PUT:()=>y});var i=r(88378),o=r(18659),n=r(8258),u=r(30019),a=r(63033),c=r(78660),d=r(19515),p=r(53767);let l=(0,c.UU)("https://ayghfeluaxotpfyuezlw.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"");async function f(e){try{let{userId:t,token:r}=await e.json();if(!t||!r)return(0,p.vV)("Account deletion missing required fields",{userId:t}),d.NextResponse.json({error:"User ID and token are required"},{status:400});let s=(0,c.UU)("https://ayghfeluaxotpfyuezlw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5Z2hmZWx1YXhvdHBmeXVlemx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM0MzMyNDAsImV4cCI6MjA0OTAwOTI0MH0.YvtVbvd41lXv0bvqUVMrYqexn3Eq7gXt3Dz87CzIm6c",{global:{headers:{Authorization:`Bearer ${r}`}}}),{data:i,error:o}=await s.auth.getUser();if(o||i?.user?.id!==t)return(0,p.vV)("Unauthorized account deletion attempt",{userId:t,authError:o,authenticatedUserId:i?.user?.id}),d.NextResponse.json({error:"Unauthorized"},{status:401});await l.from("comments").delete().eq("user_id",t),await l.from("comment_likes").delete().eq("user_id",t),await l.from("follows").delete().eq("follower_id",t),await l.from("follows").delete().eq("followee_id",t),await l.from("likes").delete().eq("author",t),await l.from("likes").delete().eq("post_author",t),await l.from("notifications").delete().eq("sender_id",t),await l.from("notifications").delete().eq("user_id",t),await l.from("post_pins").delete().eq("user_id",t),await l.from("posts").delete().eq("author",t),await l.from("posts_with_rank").delete().eq("author",t),await l.from("profiles").delete().eq("id",t);let{error:n}=await l.auth.admin.deleteUser(t);if(n)throw(0,p.vV)("Error deleting user from Supabase Auth",n),n;return d.NextResponse.json({message:"User deleted successfully"},{status:200})}catch(e){return(0,p.vV)("Account deletion failed",e),d.NextResponse.json({error:e.message},{status:500})}}let m={...a},x="workUnitAsyncStorage"in m?m.workUnitAsyncStorage:"requestAsyncStorage"in m?m.requestAsyncStorage:void 0;function q(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,s)=>{let i;try{let e=x?.getStore();i=e?.headers}catch(e){}return u.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/api/account/delete",headers:i}).apply(r,s)}})}let h=q(void 0,"GET"),g=q(void 0,"POST"),y=q(void 0,"PUT"),w=q(void 0,"PATCH"),b=q(f,"DELETE"),v=q(void 0,"HEAD"),E=q(void 0,"OPTIONS"),_=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/account/delete/route",pathname:"/api/account/delete",filename:"route",bundlePath:"app/api/account/delete/route"},resolvedPagePath:"/Users/a0000/projects/unreal/src/app/api/account/delete/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:O,workUnitAsyncStorage:k,serverHooks:I}=_;function U(){return(0,n.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:k})}},74998:e=>{"use strict";e.exports=require("perf_hooks")},75919:e=>{"use strict";e.exports=require("node:worker_threads")},76760:e=>{"use strict";e.exports=require("node:path")},77030:e=>{"use strict";e.exports=require("node:net")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},80481:e=>{"use strict";e.exports=require("node:readline")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},84297:e=>{"use strict";e.exports=require("async_hooks")},86592:e=>{"use strict";e.exports=require("node:inspector")},87558:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=87558,e.exports=t},88324:()=>{},91093:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=91093,e.exports=t},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[97015,30019,78660,95092],()=>r(74323));module.exports=s})();
//# sourceMappingURL=route.js.map