try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5a591356-7f02-40c0-931d-2338bb1c1715",e._sentryDebugIdIdentifier="sentry-dbid-5a591356-7f02-40c0-931d-2338bb1c1715")}catch(e){}(()=>{var e={};e.id=57128,e.ids=[57128],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},16236:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var s=r(77156),i=r(38152);async function n(){let e=await (0,i.UL)();return(0,s.createServerClient)("https://ayghfeluaxotpfyuezlw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5Z2hmZWx1YXhvdHBmeXVlemx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM0MzMyNDAsImV4cCI6MjA0OTAwOTI0MH0.YvtVbvd41lXv0bvqUVMrYqexn3Eq7gXt3Dz87CzIm6c",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}},auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})}},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},37067:e=>{"use strict";e.exports=require("node:http")},38522:e=>{"use strict";e.exports=require("node:zlib")},41692:e=>{"use strict";e.exports=require("node:tls")},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51927:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>I,routeModule:()=>_,serverHooks:()=>k,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{DELETE:()=>v,GET:()=>y,HEAD:()=>w,OPTIONS:()=>O,PATCH:()=>q,POST:()=>h,PUT:()=>b});var i=r(88378),n=r(18659),o=r(8258),u=r(30019),a=r(63033),c=r(16236),p=r(19515),d=r(53767);async function l(e){let t=(0,d.Lk)("GET /api/comments","api-route"),r=await (0,c.U)();try{let{searchParams:s}=new URL(e.url),i=s.get("postId");if(!i)return(0,d.FF)("Comments GET request missing postId"),t(),p.NextResponse.json({error:"Missing postId"},{status:400});let n=await r.auth.getUser(),o=(0,d.Lk)("get_comments_with_likes","database-query",{postId:i,userId:n?.data?.user?.id}),{data:u,error:a}=await r.rpc("get_comments_with_likes",{post_uuid:Number(i),current_user_id:n?.data?.user?.id});if(o(),a)return(0,d.vV)("Error fetching comments with likes",{error:a,postId:i,userId:n?.data?.user?.id}),t(),p.NextResponse.json({error:a.message},{status:500});return t(),p.NextResponse.json(u)}catch(e){return(0,d.vV)("Unexpected error in comments GET",e),t(),p.NextResponse.json({error:e.message},{status:500})}}async function m(e){let t=(0,d.Lk)("POST /api/comments","api-route"),r=await (0,c.U)();try{let{post_id:s,content:i,parent_id:n}=await e.json(),{data:o}=await r.auth.getUser();if(!o||!o.user)return(0,d.FF)("Unauthorized comment POST attempt"),t(),p.NextResponse.json({error:"Unauthorized"},{status:401});if(!s)return(0,d.FF)("Comment POST missing post_id",{userId:o.user.id}),t(),p.NextResponse.json({error:"Post ID is required"},{status:400});let u=(0,d.Lk)("insert_comment","database-write",{post_id:s,user_id:o.user.id,has_parent:!!n}),{data:a,error:c}=await r.from("comments").insert([{post_id:s,user_id:o.user.id,content:i,parent_id:n}]).select();if(u(),c)return(0,d.vV)("Error creating comment",{error:c,post_id:s,user_id:o.user.id,parent_id:n}),t(),p.NextResponse.json({error:c.message},{status:500});return t(),p.NextResponse.json(a)}catch(e){return(0,d.vV)("Unexpected error in comment POST",e),t(),p.NextResponse.json({error:e.message},{status:500})}}let f={...a},x="workUnitAsyncStorage"in f?f.workUnitAsyncStorage:"requestAsyncStorage"in f?f.requestAsyncStorage:void 0;function g(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,s)=>{let i;try{let e=x?.getStore();i=e?.headers}catch(e){}return u.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/api/comments",headers:i}).apply(r,s)}})}let y=g(l,"GET"),h=g(m,"POST"),b=g(void 0,"PUT"),q=g(void 0,"PATCH"),v=g(void 0,"DELETE"),w=g(void 0,"HEAD"),O=g(void 0,"OPTIONS"),_=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/comments/route",pathname:"/api/comments",filename:"route",bundlePath:"app/api/comments/route"},resolvedPagePath:"/Users/a0000/projects/unreal/src/app/api/comments/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:E,workUnitAsyncStorage:j,serverHooks:k}=_;function I(){return(0,o.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:j})}},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},53767:(e,t,r)=>{"use strict";r.d(t,{FF:()=>d,Lk:()=>l,vV:()=>p});var s=r(30019);let i={},n=e=>{if(null==e)return"";if("string"==typeof e)return e.substring(0,5e3);try{let t=JSON.stringify(e);return t.length>5e3?t.substring(0,5e3)+"...[truncated]":t}catch(e){return"[Object cannot be serialized]"}},o=()=>{let e=Date.now(),t=Object.keys(i);t.length>100&&t.map(e=>i[e]&&"number"==typeof i[e].timestamp?{key:e,time:i[e].timestamp}:{key:e,time:0}).sort((e,t)=>e.time-t.time).slice(0,t.length-50).map(e=>e.key).forEach(e=>delete i[e]),t.forEach(t=>{i[t]&&"number"==typeof i[t].timestamp&&e-i[t].timestamp>5e4?delete i[t]:i[t]&&"number"==typeof i[t].timestamp||delete i[t]})},u=e=>{let t=Date.now();if(i[e]){let{timestamp:r,count:s}=i[e];if(t-r<5e3)return i[e].count++,!0;i[e].timestamp=t,i[e].count++}else i[e]={timestamp:t,count:1},Object.keys(i).length>100&&o();return!1},a=(e,t)=>{let r=e instanceof Error?e.message:String(e);if(u(`error:${r.substring(0,100)}`))return;let i=t?Object.fromEntries(Object.entries(t).map(([e,t])=>[e,n(t)])):void 0;e instanceof Error?s.captureException(e,{extra:i}):s.captureException(Error(String(e)),{extra:i})},c=(e,t="info",r)=>{if("info"===t)return;let i=e.substring(0,200);if(u(`${t}:${i}`))return;let o=r?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,n(t)])):void 0;s.captureMessage(i,{level:t,extra:o})},p=(e,t)=>{let r=t instanceof Error?t.message:String(t);u(`error:${e}:${r.substring(0,50)}`)||(t?a(t,{message:e}):c(e,"error"))},d=(e,t)=>{u(`warning:${e}`)||c(e,"warning")},l=(e,t,r)=>()=>{}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57012:e=>{"use strict";e.exports=require("tls")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69764:()=>{},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74998:e=>{"use strict";e.exports=require("perf_hooks")},75919:e=>{"use strict";e.exports=require("node:worker_threads")},76760:e=>{"use strict";e.exports=require("node:path")},77030:e=>{"use strict";e.exports=require("node:net")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},80481:e=>{"use strict";e.exports=require("node:readline")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},84297:e=>{"use strict";e.exports=require("async_hooks")},86592:e=>{"use strict";e.exports=require("node:inspector")},87558:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=87558,e.exports=t},88324:()=>{},91093:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=91093,e.exports=t},91645:e=>{"use strict";e.exports=require("net")},94349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return a}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var u=n?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(s,o,u):s[o]=e[o]}return s.default=e,r&&r.set(e,s),s}(r(53605));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}let n={current:null},o="function"==typeof s.cache?s.cache:e=>e,u=console.warn;function a(e){return function(...t){u(e(...t))}}o(e=>{try{u(n.current)}finally{n.current=null}})},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[97015,30019,78660,81511,95092],()=>r(51927));module.exports=s})();
//# sourceMappingURL=route.js.map