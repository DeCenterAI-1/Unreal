{"version":3,"file":"../app/api/comments/replies/route.js","mappings":"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","sources":["webpack://unreal/external commonjs \"next/dist/server/app-render/after-task-async-storage.external.js\"","webpack://unreal/external commonjs2 \"module\"","webpack://unreal/external commonjs \"next/dist/compiled/next-server/app-page.runtime.prod.js\"","webpack://unreal/external commonjs2 \"punycode\"","webpack://unreal/./supabase/server.ts","webpack://unreal/external commonjs2 \"process\"","webpack://unreal/external commonjs2 \"os\"","webpack://unreal/external commonjs2 \"stream\"","webpack://unreal/external commonjs2 \"util\"","webpack://unreal/external commonjs2 \"fs\"","webpack://unreal/external commonjs \"next/dist/server/app-render/work-async-storage.external.js\"","webpack://unreal/external node-commonjs \"node:child_process\"","webpack://unreal/external commonjs2 \"path\"","webpack://unreal/external commonjs2 \"diagnostics_channel\"","webpack://unreal/external node-commonjs \"node:http\"","webpack://unreal/external node-commonjs \"node:zlib\"","webpack://unreal/external node-commonjs \"node:tls\"","webpack://unreal/external node-commonjs \"node:https\"","webpack://unreal/external commonjs \"next/dist/compiled/next-server/app-route.runtime.prod.js\"","webpack://unreal/external node-commonjs \"node:os\"","webpack://unreal/external node-commonjs \"node:diagnostics_channel\"","webpack://unreal/./src/utils/sentryUtils.ts","webpack://unreal/external commonjs2 \"crypto\"","webpack://unreal/external commonjs2 \"https\"","webpack://unreal/external commonjs2 \"tls\"","webpack://unreal/external node-commonjs \"node:stream\"","webpack://unreal/external node-commonjs \"node:util\"","webpack://unreal/external commonjs \"next/dist/server/app-render/work-unit-async-storage.external.js\"","webpack://unreal/external node-commonjs \"node:fs\"","webpack://unreal/external commonjs2 \"worker_threads\"","webpack://unreal/external commonjs2 \"zlib\"","webpack://unreal/external commonjs2 \"perf_hooks\"","webpack://unreal/external node-commonjs \"node:worker_threads\"","webpack://unreal/external node-commonjs \"node:path\"","webpack://unreal/external node-commonjs \"node:net\"","webpack://unreal/external commonjs2 \"buffer\"","webpack://unreal/external commonjs2 \"url\"","webpack://unreal/external commonjs2 \"child_process\"","webpack://unreal/external node-commonjs \"node:readline\"","webpack://unreal/external commonjs2 \"http\"","webpack://unreal/external commonjs2 \"tty\"","webpack://unreal/external commonjs2 \"async_hooks\"","webpack://unreal/external node-commonjs \"node:inspector\"","webpack://unreal/./node_modules/.pnpm/@opentelemetry+instrumentation@0.57.2_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://unreal/./node_modules/.pnpm/require-in-the-middle@7.5.2/node_modules/require-in-the-middle/ sync","webpack://unreal/external commonjs2 \"net\"","webpack://unreal/./node_modules/.pnpm/next@15.2.4_@babel+core@7.26.10_@opentelemetry+api@1.9.0_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/next/dist/server/create-deduped-by-callsite-server-error-logger.js","webpack://unreal/external commonjs2 \"events\"","webpack://unreal/src/app/api/comments/replies/route.ts","webpack://unreal/sentry-wrapper-module","webpack://unreal/?c686"],"sourcesContent":["module.exports = require(\"next/dist/server/app-render/after-task-async-storage.external.js\");","module.exports = require(\"module\");","module.exports = require(\"next/dist/compiled/next-server/app-page.runtime.prod.js\");","module.exports = require(\"punycode\");","import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { SupabaseClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"$/types/database.types\";\n\nexport async function createClient(): Promise<SupabaseClient<Database>> {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options),\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n      auth: {\n        autoRefreshToken: true,\n        persistSession: true,\n        detectSessionInUrl: true,\n      },\n    },\n  );\n}\n","module.exports = require(\"process\");","module.exports = require(\"os\");","module.exports = require(\"stream\");","module.exports = require(\"util\");","module.exports = require(\"fs\");","module.exports = require(\"next/dist/server/app-render/work-async-storage.external.js\");","module.exports = require(\"node:child_process\");","module.exports = require(\"path\");","module.exports = require(\"diagnostics_channel\");","module.exports = require(\"node:http\");","module.exports = require(\"node:zlib\");","module.exports = require(\"node:tls\");","module.exports = require(\"node:https\");","module.exports = require(\"next/dist/compiled/next-server/app-route.runtime.prod.js\");","module.exports = require(\"node:os\");","module.exports = require(\"node:diagnostics_channel\");","import * as Sentry from \"@sentry/nextjs\";\n\n// Track throttled messages to avoid duplicates\ninterface ThrottleCache {\n  [key: string]: {\n    timestamp: number;\n    count: number;\n  };\n}\n\n// Cache for throttling\nconst messageCache: ThrottleCache = {};\nconst MIN_THROTTLE_MS = 5000; // 5 seconds between identical messages\nconst MAX_CACHE_SIZE = 100;\nconst MAX_OBJECT_SIZE = 5000; // Characters limit for stringified objects\n\n/**\n * Safely stringify data, with size limits to prevent performance issues\n */\nconst safeStringify = (data: any): string => {\n  if (data === undefined || data === null) return \"\";\n  if (typeof data === \"string\") return data.substring(0, MAX_OBJECT_SIZE);\n\n  try {\n    const str = JSON.stringify(data);\n    return str.length > MAX_OBJECT_SIZE\n      ? str.substring(0, MAX_OBJECT_SIZE) + \"...[truncated]\"\n      : str;\n  } catch (e) {\n    return \"[Object cannot be serialized]\";\n  }\n};\n\n/**\n * Clean the throttle cache periodically\n */\nconst cleanThrottleCache = (): void => {\n  const now = Date.now();\n  const keys = Object.keys(messageCache);\n\n  if (keys.length > MAX_CACHE_SIZE) {\n    // Remove oldest entries if cache is too large\n    const oldestKeys = keys\n      .map((key) => {\n        // Add safety check for undefined entries\n        if (\n          !messageCache[key] ||\n          typeof messageCache[key].timestamp !== \"number\"\n        ) {\n          return { key, time: 0 };\n        }\n        return { key, time: messageCache[key].timestamp };\n      })\n      .sort((a, b) => a.time - b.time)\n      .slice(0, keys.length - MAX_CACHE_SIZE / 2)\n      .map((item) => item.key);\n\n    oldestKeys.forEach((key) => delete messageCache[key]);\n  }\n\n  // Remove expired entries\n  keys.forEach((key) => {\n    // Add safety check for undefined entries\n    if (\n      messageCache[key] &&\n      typeof messageCache[key].timestamp === \"number\" &&\n      now - messageCache[key].timestamp > MIN_THROTTLE_MS * 10\n    ) {\n      delete messageCache[key];\n    } else if (\n      !messageCache[key] ||\n      typeof messageCache[key].timestamp !== \"number\"\n    ) {\n      // Remove invalid entries that could cause errors\n      delete messageCache[key];\n    }\n  });\n};\n\n// Clean cache every minute\nif (typeof window !== \"undefined\") {\n  setInterval(cleanThrottleCache, 60000);\n}\n\n/**\n * Check if a message is throttled\n * Returns true if the message should be skipped\n */\nconst isThrottled = (cacheKey: string): boolean => {\n  const now = Date.now();\n\n  if (messageCache[cacheKey]) {\n    const { timestamp, count } = messageCache[cacheKey];\n    const elapsed = now - timestamp;\n\n    if (elapsed < MIN_THROTTLE_MS) {\n      // Update count but don't send\n      messageCache[cacheKey].count++;\n      return true;\n    }\n\n    // Update timestamp and count\n    messageCache[cacheKey].timestamp = now;\n    messageCache[cacheKey].count++;\n  } else {\n    // First occurrence\n    messageCache[cacheKey] = { timestamp: now, count: 1 };\n\n    // Clean cache if it gets too large\n    if (Object.keys(messageCache).length > MAX_CACHE_SIZE) {\n      cleanThrottleCache();\n    }\n  }\n\n  return false;\n};\n\n/**\n * Log an error to Sentry with additional context\n */\nexport const captureException = (\n  error: Error | unknown,\n  context?: Record<string, any>\n): void => {\n  // Skip in development for better performance, just log to console\n  if (process.env.NODE_ENV === \"development\") {\n    console.error(error, context);\n    return;\n  }\n\n  // Create a throttle key based on error message\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  const throttleKey = `error:${errorMessage.substring(0, 100)}`;\n\n  if (isThrottled(throttleKey)) return;\n\n  // Limit context size to prevent performance issues\n  const safeContext = context\n    ? Object.fromEntries(\n        Object.entries(context).map(([key, value]) => [\n          key,\n          safeStringify(value),\n        ])\n      )\n    : undefined;\n\n  if (error instanceof Error) {\n    Sentry.captureException(error, {\n      extra: safeContext,\n    });\n  } else {\n    Sentry.captureException(new Error(String(error)), {\n      extra: safeContext,\n    });\n  }\n};\n\n/**\n * Log a message to Sentry at the specified level\n */\nexport const captureMessage = (\n  message: string,\n  level: Sentry.SeverityLevel = \"info\",\n  context?: Record<string, any>\n): void => {\n  // Skip low-priority messages in production\n  if (process.env.NODE_ENV === \"production\" && level === \"info\") {\n    return;\n  }\n\n  // Limit message size\n  const safeMessage = message.substring(0, 200);\n\n  // Create throttle key based on message\n  const throttleKey = `${level}:${safeMessage}`;\n\n  if (isThrottled(throttleKey)) return;\n\n  // Limit context size\n  const safeContext = context\n    ? Object.fromEntries(\n        Object.entries(context).map(([key, value]) => [\n          key,\n          safeStringify(value),\n        ])\n      )\n    : undefined;\n\n  Sentry.captureMessage(safeMessage, {\n    level,\n    extra: safeContext,\n  });\n};\n\n/**\n * Set the current user for Sentry tracking\n */\nexport const setUser = (\n  id: string | null,\n  email?: string,\n  username?: string,\n  additionalData?: Record<string, any>\n): void => {\n  if (id) {\n    Sentry.setUser({\n      id,\n      email,\n      username,\n      ...additionalData,\n    });\n  } else {\n    // Clear user data when id is null\n    Sentry.setUser(null);\n  }\n};\n\n/**\n * Add breadcrumb to track user or system actions\n */\nexport const addBreadcrumb = (\n  message: string,\n  category?: string,\n  level: Sentry.SeverityLevel = \"info\",\n  data?: Record<string, any>\n): void => {\n  // Skip breadcrumbs in production for better performance\n  if (process.env.NODE_ENV === \"production\" && level === \"info\") {\n    return;\n  }\n\n  // Limit data size\n  const safeData = data\n    ? Object.fromEntries(\n        Object.entries(data).map(([key, value]) => [key, safeStringify(value)])\n      )\n    : undefined;\n\n  Sentry.addBreadcrumb({\n    message: message.substring(0, 100),\n    category,\n    level,\n    data: safeData,\n  });\n};\n\n/**\n * Set context information for current scope\n */\nexport const setContext = (\n  name: string,\n  context: Record<string, any>\n): void => {\n  // Limit context size\n  const safeContext = Object.fromEntries(\n    Object.entries(context).map(([key, value]) => [key, safeStringify(value)])\n  );\n\n  Sentry.setContext(name, safeContext);\n};\n\n/**\n * Replace console.log in production\n * In development, it will only log to console\n * In production, it will send to Sentry as warning-level message only if important\n */\nexport const log = (message: string, data?: any): void => {\n  const isDev = process.env.NODE_ENV === \"development\";\n\n  if (isDev) {\n    console.log(message, data);\n    return;\n  }\n\n  // In production, only log critical info\n  // Most info logs can be skipped entirely\n  if (\n    message.includes(\"error\") ||\n    message.includes(\"fail\") ||\n    message.includes(\"critical\")\n  ) {\n    captureMessage(`${message}`, \"warning\");\n  }\n};\n\n/**\n * Replace console.error in production\n * Always captures as error in Sentry, only logs to console in development\n */\nexport const logError = (message: string, error?: Error | unknown): void => {\n  const isDev = process.env.NODE_ENV === \"development\";\n\n  if (isDev) {\n    console.error(message, error);\n    return;\n  }\n\n  // Create throttle key for this error\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  const throttleKey = `error:${message}:${errorMessage.substring(0, 50)}`;\n\n  if (isThrottled(throttleKey)) return;\n\n  if (error) {\n    captureException(error, { message });\n  } else {\n    captureMessage(message, \"error\");\n  }\n};\n\n/**\n * Replace console.warn in production\n * Captures as warning in Sentry, only logs to console in development\n */\nexport const logWarning = (message: string, data?: any): void => {\n  const isDev = process.env.NODE_ENV === \"development\";\n\n  if (isDev) {\n    console.warn(message, data);\n    return;\n  }\n\n  // Create throttle key for this warning\n  const throttleKey = `warning:${message}`;\n\n  if (isThrottled(throttleKey)) return;\n\n  captureMessage(message, \"warning\");\n};\n\n/**\n * Start performance monitoring span\n * Returns a function to call when the operation is complete\n */\nexport const startSpan = (\n  name: string,\n  op: string,\n  data?: Record<string, any>\n): (() => void) => {\n  // Skip in production environments where we've disabled performance monitoring for speed\n  if (process.env.NODE_ENV === \"production\") {\n    // Return empty function as noop\n    return () => {};\n  }\n\n  try {\n    // Create unique ID for this operation\n    const spanId = `${op}-${name}-${Date.now()}`;\n    const startTime = performance.now();\n\n    // Add breadcrumb for operation start\n    const safeData = data\n      ? Object.fromEntries(\n          Object.entries(data).map(([key, value]) => [\n            key,\n            safeStringify(value),\n          ])\n        )\n      : undefined;\n\n    // Safely add breadcrumb with error handling\n    try {\n      addBreadcrumb(`Started ${op}: ${name}`, \"performance\", \"info\", {\n        ...safeData,\n        spanId,\n      });\n    } catch (e) {\n      // Silently fail breadcrumb to not affect performance\n      console.warn(\"Failed to add breadcrumb:\", e);\n    }\n\n    // Return a function to finish the span\n    return () => {\n      try {\n        const endTime = performance.now();\n        const duration = Math.round(endTime - startTime);\n\n        // Only track operations that took significant time (> 50ms)\n        if (duration > 50) {\n          try {\n            addBreadcrumb(\n              `Finished ${op}: ${name} (${duration}ms)`,\n              \"performance\",\n              duration > 500 ? \"warning\" : \"info\", // Mark slow operations as warnings\n              {\n                ...safeData,\n                duration,\n                spanId,\n              }\n            );\n\n            // For very slow operations (>1s), send a performance issue\n            if (duration > 1000) {\n              captureMessage(\n                `Slow operation: ${op} - ${name} took ${duration}ms`,\n                \"warning\",\n                {\n                  performance: true,\n                  duration,\n                  operation: op,\n                  ...safeData,\n                }\n              );\n            }\n          } catch (e) {\n            // Silently fail to not affect performance\n            console.warn(\"Failed to record performance data:\", e);\n          }\n        }\n      } catch (e) {\n        // Silently fail to not affect performance\n        console.warn(\"Failed to finish performance span:\", e);\n      }\n    };\n  } catch (e) {\n    // Return a no-op function if anything fails\n    console.warn(\"Failed to start performance tracking:\", e);\n    return () => {};\n  }\n};\n\n/**\n * Set extra data on the current scope\n */\nexport const setExtra = (key: string, value: any): void => {\n  Sentry.setExtra(key, safeStringify(value));\n};\n","module.exports = require(\"crypto\");","module.exports = require(\"https\");","module.exports = require(\"tls\");","module.exports = require(\"node:stream\");","module.exports = require(\"node:util\");","module.exports = require(\"next/dist/server/app-render/work-unit-async-storage.external.js\");","module.exports = require(\"node:fs\");","module.exports = require(\"worker_threads\");","module.exports = require(\"zlib\");","module.exports = require(\"perf_hooks\");","module.exports = require(\"node:worker_threads\");","module.exports = require(\"node:path\");","module.exports = require(\"node:net\");","module.exports = require(\"buffer\");","module.exports = require(\"url\");","module.exports = require(\"child_process\");","module.exports = require(\"node:readline\");","module.exports = require(\"http\");","module.exports = require(\"tty\");","module.exports = require(\"async_hooks\");","module.exports = require(\"node:inspector\");","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 87558;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 91093;\nmodule.exports = webpackEmptyContext;","module.exports = require(\"net\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"createDedupedByCallsiteServerErrorLoggerDev\", {\n    enumerable: true,\n    get: function() {\n        return createDedupedByCallsiteServerErrorLoggerDev;\n    }\n});\nconst _react = /*#__PURE__*/ _interop_require_wildcard(require(\"react\"));\nfunction _getRequireWildcardCache(nodeInterop) {\n    if (typeof WeakMap !== \"function\") return null;\n    var cacheBabelInterop = new WeakMap();\n    var cacheNodeInterop = new WeakMap();\n    return (_getRequireWildcardCache = function(nodeInterop) {\n        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n    })(nodeInterop);\n}\nfunction _interop_require_wildcard(obj, nodeInterop) {\n    if (!nodeInterop && obj && obj.__esModule) {\n        return obj;\n    }\n    if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n        return {\n            default: obj\n        };\n    }\n    var cache = _getRequireWildcardCache(nodeInterop);\n    if (cache && cache.has(obj)) {\n        return cache.get(obj);\n    }\n    var newObj = {\n        __proto__: null\n    };\n    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n    for(var key in obj){\n        if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n            if (desc && (desc.get || desc.set)) {\n                Object.defineProperty(newObj, key, desc);\n            } else {\n                newObj[key] = obj[key];\n            }\n        }\n    }\n    newObj.default = obj;\n    if (cache) {\n        cache.set(obj, newObj);\n    }\n    return newObj;\n}\nconst errorRef = {\n    current: null\n};\n// React.cache is currently only available in canary/experimental React channels.\nconst cache = typeof _react.cache === 'function' ? _react.cache : (fn)=>fn;\n// When Dynamic IO is enabled, we record these as errors so that they\n// are captured by the dev overlay as it's more critical to fix these\n// when enabled.\nconst logErrorOrWarn = process.env.__NEXT_DYNAMIC_IO ? console.error : console.warn;\n// We don't want to dedupe across requests.\n// The developer might've just attempted to fix the warning so we should warn again if it still happens.\nconst flushCurrentErrorIfNew = cache(// eslint-disable-next-line @typescript-eslint/no-unused-vars -- cache key\n(key)=>{\n    try {\n        logErrorOrWarn(errorRef.current);\n    } finally{\n        errorRef.current = null;\n    }\n});\nfunction createDedupedByCallsiteServerErrorLoggerDev(getMessage) {\n    return function logDedupedError(...args) {\n        const message = getMessage(...args);\n        if (process.env.NODE_ENV !== 'production') {\n            var _stack;\n            const callStackFrames = (_stack = new Error().stack) == null ? void 0 : _stack.split('\\n');\n            if (callStackFrames === undefined || callStackFrames.length < 4) {\n                logErrorOrWarn(message);\n            } else {\n                // Error:\n                //   logDedupedError\n                //   asyncApiBeingAccessedSynchronously\n                //   <userland callsite>\n                // TODO: This breaks if sourcemaps with ignore lists are enabled.\n                const key = callStackFrames[4];\n                errorRef.current = message;\n                flushCurrentErrorIfNew(key);\n            }\n        } else {\n            logErrorOrWarn(message);\n        }\n    };\n}\n\n//# sourceMappingURL=create-deduped-by-callsite-server-error-logger.js.map","module.exports = require(\"events\");","import { createClient } from \"$/supabase/server\";\nimport { NextResponse } from \"next/server\";\nimport { logError, logWarning } from \"@/utils/sentryUtils\";\n\n// ✅ Fetch replies for a specific comment\nexport async function GET(req: Request) {\n  const supabase = await createClient();\n\n  try {\n    const { searchParams } = new URL(req.url);\n    const parentId = searchParams.get(\"parentId\");\n\n    if (!parentId) {\n      logWarning(\"Replies GET request missing parentId\");\n      return NextResponse.json({ error: \"Missing parentId\" }, { status: 400 });\n    }\n\n    const user = await supabase.auth.getUser();\n\n    const { data, error } = await supabase.rpc(\"get_replies_with_likes\", {\n      given_parent_id: parentId,\n      current_user_id: user?.data?.user?.id as string,\n    });\n\n    if (error) {\n      logError(\"Error fetching comment replies\", {\n        error,\n        parentId,\n        userId: user?.data?.user?.id,\n      });\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    return NextResponse.json(data);\n  } catch (error: any) {\n    logError(\"Unexpected error in replies GET\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n","import * as Sentry from '@sentry/nextjs';\nimport * as origModule from 'next/dist/server/app-render/work-unit-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        headers = requestAsyncStore?.headers;\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/api/comments/replies',\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Users/a0000/projects/unreal/src/app/api/comments/replies/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/comments/replies/route\",\n        pathname: \"/api/comments/replies\",\n        filename: \"route\",\n        bundlePath: \"app/api/comments/replies/route\"\n    },\n    resolvedPagePath: \"/Users/a0000/projects/unreal/src/app/api/comments/replies/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map"],"names":["createClient","cookieStore","cookies","createServerClient","process","getAll","setAll","cookiesToSet","forEach","name","value","options","set","auth","autoRefreshToken","persistSession","detectSessionInUrl","messageCache","safeStringify","data","undefined","substring","MAX_OBJECT_SIZE","str","JSON","stringify","length","e","cleanThrottleCache","now","Date","keys","Object","MAX_CACHE_SIZE","map","key","timestamp","time","sort","a","b","slice","item","MIN_THROTTLE_MS","isThrottled","cacheKey","count","captureException","error","context","errorMessage","Error","message","String","throttleKey","safeContext","fromEntries","entries","Sentry","extra","level","safeMessage","captureMessage","op","GET","req","supabase","searchParams","URL","url","parentId","get","logWarning","NextResponse","json","status","user","getUser","rpc","given_parent_id","current_user_id","id","logError","userId","serverComponentModule.GET","serverComponentModule.POST","serverComponentModule.PUT","serverComponentModule.PATCH","serverComponentModule.DELETE","serverComponentModule.HEAD","serverComponentModule.OPTIONS"],"sourceRoot":""}